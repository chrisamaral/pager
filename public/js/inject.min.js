(function(w,C){function t(a,b){if(!b)throw Error("proxying requires a scope");if(!a)throw Error("proxying requires a function");return function(){return a.apply(b,arguments)}}function D(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c])}function S(){return"INJECT_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}function z(a,b,c){window.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function I(a,b,c,d){d||
(d={});d=JSON.stringify(d);a.postMessage([c,d].join(":"),b)}function u(a){a=a||{guess:!0};var b=a.e||null;a=!!a.guess;var c=new u.implementation,b=c.run(b);return a?c.guessAnonymousFunctions(b):b}function T(a){a.rulesEngine.addFetchRule(/^.+?\!.+$/,function(b,c,d,e,f){var g=f.parentId;c=f.parentUrl;e=f.moduleId.split("!");f=d.module(e[0],g);d.url(f,c);var h=e[1],k=a.requireContext.createRequire(g,c),m=function(){return k.apply(k,arguments)};c=function(a){m[a]=function(){return k[a].apply(k,arguments)}};
for(var l in k)E.call(k,l)&&c(l);var q=function(a){return d.module(a,g)};k([f],function(c){var d=c.normalize?c.normalize(h,q):q(h),f=function(a){"string"===typeof a&&(a=['module.exports = decodeURIComponent("',encodeURIComponent(a),'");'].join(""));b(null,a)};f.fromText=function(b,c){c||(c=b,b=null);var d=a.executor.createModule(b);a.executor.runModule(d,c)};c.load(d,m,f,{})})})}var y,U=eval("/*@cc_on!@*/false");navigator.userAgent.toLowerCase().indexOf("gecko");var V=/.*?\.(js|txt)(\?.*)?$/,W=RegExp("(?:^|[\\s;,=\\?:\\}\\)\\(])require[\\s]*\\(['\"]([^'\"]+?)['\"]\\)",
"gim"),X=RegExp("(?:^|[\\s;,\\?\\}\\)\\(])define[\\s]*\\([^\\)]*?\\[([\\w\\W]*?)\\]","gim"),Y=RegExp("['\"]([\\w\\W]*?)['\"]","gim"),K={require:!0,exports:!0,module:!0},Z=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,L=/^([A-Za-z]+:)?\/\//,F=/:\/\//,M=/__INJECT_PROTOCOL_COLON_SLASH_SLASH__/,E=Object.prototype.hasOwnProperty,p;try{localStorage.setItem("injectLStest","ok"),localStorage.removeItem("injectLStest"),p=!0}catch(fa){p=!1}var N=p,O=/^\/+/g,P={sourceMap:!1,logging:!1};w=this;var s=function(){};
(function(){var a=function(a,c){P&&P.logging&&console.log("## "+a+" ##\n"+c)};"undefined"!==typeof console&&console.log&&"function"===typeof console.log&&(s=a)})();var G;(function(a){a.addEventListener?(z=function(a,c,d,e){a.addEventListener(c,d,e||!1)},G=function(a,c,d,e){a.removeEventListener(c,d,e||!1)}):(z=function(a,c,d){a.attachEvent("on"+c,d)},G=function(a,c,d){a.detachEvent("on"+c,d)})})(window);var B=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,$=function(){for(var a=[function(){return new XMLHttpRequest},
function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=!1,c=0;c<a.length;c++){try{a[c](),b=a[c]}catch(d){continue}break}return b}(),n={exports:{}};(function(a){function b(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])}function c(){}var d=!1,e=Array.prototype,f=a.Fiber;c.extend=function(a){function f(){d||(this.init.apply(this,arguments),this.init=void 0)}var e=this.prototype;a=
a(e);var m;d=!0;m=f.prototype=new this;d=!1;m.init=function(){"function"===typeof e.init&&e.init.apply(this,arguments)};b(a,m);m.constructor=f;f.__base__=e;f.extend=c.extend;return f};c.proxy=function(a,b){var c,d={},f;1===arguments.length&&(b=a,a=b.constructor.__base__);f=function(c){return function(){return a[c].apply(b,arguments)}};for(c in a)a.hasOwnProperty(c)&&"function"===typeof a[c]&&(d[c]=f(c));return d};c.decorate=function(a){var c,d=a.constructor.__base__,f=e.slice.call(arguments,1),l=
f.length;for(c=0;c<l;c++)b(f[c].call(a,d),a)};c.mixin=function(a){var c,d=a.__base__,f=e.slice.call(arguments,1),l=f.length;for(c=0;c<l;c++)b(f[c](d),a.prototype)};c.noConflict=function(){a.Fiber=f;return c};"undefined"!==typeof n?"function"===typeof n.setExports?n.setExports(c):n.exports&&(n.exports=c):a.Fiber=c})(this);p=n.exports;n=C;n={exports:{}};"undefined"!==typeof n&&n.exports&&(n.exports=u);u.implementation=function(){};u.implementation.prototype={run:function(a,b){a=a||this.createException();
b=b||this.mode(a);return"other"===b?this.other(arguments.callee):this[b](a)},createException:function(){try{this.undef()}catch(a){return a}},mode:function(a){return a.arguments&&a.stack?"chrome":a.stack&&a.sourceURL?"safari":a.stack&&a.number?"ie":"string"===typeof a.message&&"undefined"!==typeof window&&window.opera?!a.stacktrace||-1<a.message.indexOf("\n")&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":a.stack?0>a.stacktrace.indexOf("called from line")?"opera10b":"opera11":
"opera10a":a.stack?"firefox":"other"},instrumentFunction:function(a,b,c){a=a||window;var d=a[b];a[b]=function(){c.call(this,u().slice(4));return a[b]._instrumented.apply(this,arguments)};a[b]._instrumented=d},deinstrumentFunction:function(a,b){a[b].constructor===Function&&a[b]._instrumented&&a[b]._instrumented.constructor===Function&&(a[b]=a[b]._instrumented)},chrome:function(a){a=(a.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,
"{anonymous}()@$1").split("\n");a.pop();return a},safari:function(a){return a.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(a){return a.stack.replace(/at Anonymous function /gm,"{anonymous}()@").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^.*at (\w+) \(([^\)]+)\)$/gm,"$1@$2").split("\n")},firefox:function(a){return a.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^[\(@]/gm,"{anonymous}()@").split("\n")},opera11:function(a){var b=
/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;a=a.stacktrace.split("\n");for(var c=[],d=0,e=a.length;d<e;d+=2){var f=b.exec(a[d]);if(f){var g=f[4]+":"+f[1]+":"+f[2],f=f[3]||"global code",f=f.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");c.push(f+"@"+g+" -- "+a[d+1].replace(/^\s+/,""))}}return c},opera10b:function(a){var b=/^(.*)@(.+):(\d+)$/;a=a.stacktrace.split("\n");for(var c=[],d=0,e=a.length;d<e;d++){var f=b.exec(a[d]);f&&c.push((f[1]?f[1]+"()":
"global code")+"@"+f[2]+":"+f[3])}return c},opera10a:function(a){var b=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;a=a.stacktrace.split("\n");for(var c=[],d=0,e=a.length;d<e;d+=2){var f=b.exec(a[d]);f&&c.push((f[3]||"{anonymous}")+"()@"+f[2]+":"+f[1]+" -- "+a[d+1].replace(/^\s+/,""))}return c},opera9:function(a){var b=/Line (\d+).*script (?:in )?(\S+)/i;a=a.message.split("\n");for(var c=[],d=2,e=a.length;d<e;d+=2){var f=b.exec(a[d]);f&&c.push("{anonymous}()@"+f[2]+":"+f[1]+" -- "+
a[d+1].replace(/^\s+/,""))}return c},other:function(a){for(var b=/function\s*([\w\-$]+)?\s*\(/i,c=[],d,e;a&&a.arguments&&10>c.length;)d=b.test(a.toString())?RegExp.$1||"{anonymous}":"{anonymous}",e=Array.prototype.slice.call(a.arguments||[]),c[c.length]=d+"("+this.stringifyArguments(e)+")",a=a.caller;return c},stringifyArguments:function(a){for(var b=[],c=Array.prototype.slice,d=0;d<a.length;++d){var e=a[d];e===C?b[d]="undefined":null===e?b[d]="null":e.constructor&&(e.constructor===Array?b[d]=3>e.length?
"["+this.stringifyArguments(e)+"]":"["+this.stringifyArguments(c.call(e,0,1))+"..."+this.stringifyArguments(c.call(e,-1))+"]":e.constructor===Object?b[d]="#object":e.constructor===Function?b[d]="#function":e.constructor===String?b[d]='"'+e+'"':e.constructor===Number&&(b[d]=e))}return b.join(",")},sourceCache:{},ajax:function(a){var b=this.createXMLHTTPObject();if(b)try{return b.open("GET",a,!1),b.send(null),b.responseText}catch(c){}return""},createXMLHTTPObject:function(){for(var a,b=[function(){return new XMLHttpRequest},
function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],c=0;c<b.length;c++)try{return a=b[c](),this.createXMLHTTPObject=b[c],a}catch(d){}},isSameDomain:function(a){return"undefined"!==typeof location&&-1!==a.indexOf(location.hostname)},getSource:function(a){a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n"));return this.sourceCache[a]},guessAnonymousFunctions:function(a){for(var b=
0;b<a.length;++b){var c=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,d=a[b],e=/\{anonymous\}\(.*\)@(.*)/.exec(d);if(e){var f=c.exec(e[1]);f&&(c=f[1],e=f[2],f=f[3]||0,c&&this.isSameDomain(c)&&e&&(c=this.guessAnonymousFunction(c,e,f),a[b]=d.replace("{anonymous}",c)))}}return a},guessAnonymousFunction:function(a,b,c){var d;try{d=this.findFunctionName(this.getSource(a),b)}catch(e){d="getSource failed with url: "+a+", exception: "+e.toString()}return d},findFunctionName:function(a,b){for(var c=/function\s+([^(]*?)\s*\(([^)]*)\)/,
d=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,e=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,f="",g,h=Math.min(b,20),k,m=0;m<h;++m)if(g=a[b-m-1],k=g.indexOf("//"),0<=k&&(g=g.substr(0,k)),g)if(f=g+f,(g=d.exec(f))&&g[1]||(g=c.exec(f))&&g[1]||(g=e.exec(f))&&g[1])return g[1];return"(?)"}};var u=n.exports,n=C,Q=function(){var a,b=[],c=setTimeout(function(){c=null;a._next()},0);return a={destroy:function(){c&&clearTimeout(c)},par:function(c,e){!e&&b[b.length-1]instanceof
Array||b.push([]);b[b.length-1].push(c);return a},seq:function(b){return a.par(b,!0)},_next:function(c,e){for(var f=[],g=[],h=b.shift()||[],k=h.length,m=1==k,l=0;l<h.length;l++)(function(b,h){b(function(b,c){f[h]=b;g[h]=c;0==--k&&a._next(m?f[0]:f,m?g[0]:g)},c,e)})(h[l],l)}}},v=function(){function a(){if(void 0!==g)return g;try{c("__lscachetest__","__lscachetest__"),d("__lscachetest__"),g=!0}catch(a){g=!1}return g}function b(){void 0===h&&(h=null!=window.JSON);return h}function c(a,b){localStorage.removeItem(e+
k+a);localStorage.setItem(e+k+a,b)}function d(a){localStorage.removeItem(e+k+a)}var e="lscache-",f=Math.floor(144E9),g,h,k="";return{set:function(g,h,q){if(a()){if("string"!==typeof h){if(!b())return;try{h=JSON.stringify(h)}catch(x){return}}try{c(g,h)}catch(J){if("QUOTA_EXCEEDED_ERR"===J.name||"NS_ERROR_DOM_QUOTA_REACHED"===J.name){for(var A=[],r,n=0;n<localStorage.length;n++)if(r=localStorage.key(n),0===r.indexOf(e+k)&&0>r.indexOf("-cacheexpiration")){r=r.substr((e+k).length);var p=localStorage.getItem(e+
k+(r+"-cacheexpiration")),p=p?parseInt(p,10):f;A.push({key:r,size:(localStorage.getItem(e+k+r)||"").length,expiration:p})}A.sort(function(a,b){return b.expiration-a.expiration});for(n=(h||"").length;A.length&&0<n;)r=A.pop(),d(r.key),d(r.key+"-cacheexpiration"),n-=r.size;try{c(g,h)}catch(s){return}}else return}q?c(g+"-cacheexpiration",(Math.floor((new Date).getTime()/6E4)+q).toString(10)):d(g+"-cacheexpiration")}},get:function(c){if(!a())return null;var f=c+"-cacheexpiration",g=localStorage.getItem(e+
k+f);if(g&&(g=parseInt(g,10),Math.floor((new Date).getTime()/6E4)>=g))return d(c),d(f),null;c=localStorage.getItem(e+k+c);if(!c||!b())return c;try{return JSON.parse(c)}catch(h){return c}},remove:function(b){if(!a())return null;d(b);d(b+"-cacheexpiration")},supported:function(){return a()},flush:function(){if(a())for(var b=localStorage.length-1;0<=b;--b){var c=localStorage.key(b);0===c.indexOf(e+k)&&localStorage.removeItem(c)}},setBucket:function(a){k=a},resetBucket:function(){k=""}}}();(function(){var a;
N&&v&&(v.setBucket("INJECT"),(a=v.get("!version"))&&0<a&&1>a&&(v.flush(),v.set("!version",1)))})();var aa=p.extend(function(){return{init:function(){},stripBuiltins:function(a){var b=[],c=a.length,d=0;for(d;d<c;d++)K[a[d]]||b.push(a[d]);return b},extractRequires:function(a){var b=[],c={require:1,module:1,exports:1},d,e;if(!a)return[];for(a=a.replace(Z,"");d=W.exec(a);)e=d[1],c[e]||(c[e]=1,b.push(e));for(;d=X.exec(a);)for(;e=Y.exec(d[1]);)e=e[1],c[e]||(c[e]=1,b.push(e));return b}}}),ba=p.extend(function(){return{init:function(a){this.env=
a;this.clearCaches();this.alreadyListening=!1;this.socket=null;this.socketInProgress=!1;this.socketQueue=[];this.socketQueueCache={};this.downloadCompleteQueue={}},clearCaches:function(){self.downloadCompleteQueue={}},noop:function(a,b,c){c("")},get:function(a,b,c){this.downloadCompleteQueue[b]||(this.downloadCompleteQueue[b]=[]);s("Communicator ("+b+")","requesting");if(!this.env.config.relayFile&&(a=this.readFromCache(b))){s("Communicator ("+b+")","retireved from cache. length: "+a.length);c(a);
return}s("Communicator ("+b+")","queued");this.downloadCompleteQueue[b].length?(this.downloadCompleteQueue[b].push(c),s("Communicator ("+b+")","request already in progress")):(this.downloadCompleteQueue[b].push(c),this.env.config.relayFile&&b.match(B)[3]!==location.href.match(B)[3]?this.sendViaIframe(b):this.sendViaXHR(b))},addSocketQueue:function(a){this.socketQueueCache[a]||(this.socketQueueCache[a]=1,this.socketQueue.push(a))},beginListening:function(){var a=this;this.alreadyListening||(this.alreadyListening=
!0,z(window,"message",function(b){var c;if(a.env.config.relayFile&&b.origin.match(B)[3]===a.env.config.relayFile.match(B)[3])switch(b=b.data.split(/:/),c=b.shift(),c){case "ready":a.socketInProgress=!1;b=a.socketQueue;a.socketQueue=[];a.socketQueueCache={};c=0;for(var d=b.length;c<d;c++)I(a.socket.contentWindow,a.env.config.relayFile,"fetch",{url:b[c]});break;case "fetchFail":case "fetchOk":b=JSON.parse(b.join(":")),a.resolveCompletedFile(b.url,b.status,b.responseText)}}))},readFromCache:function(a){return 0<
this.env.config.expires?this.env.cache.get(a):null},resolveCompletedFile:function(a,b,c){b*=1;s("Communicator ("+a+")","status "+b+". Length: "+(c?c.length:"NaN"));200===b&&!this.env.config.relayFile&&0<this.env.config.expires&&this.env.cache.set(a,c,this.env.config.expires);200!==b&&(c="throw new Error('Error "+b+": Unable to retrieve "+a+"');");D(this.downloadCompleteQueue[a],function(a){a(c)});this.downloadCompleteQueue[a]=[]},sendViaIframe:function(a){this.beginListening();var b=this;this.socket&&
!this.socketInProgress?I(this.socket.contentWindow,this.env.config.relayFile,"fetch",{url:a}):this.socket&&this.socketInProgress?this.addSocketQueue(a):(this.socketInProgress=!0,this.addSocketQueue(a),this.socket=this.buildIframe(),window.setTimeout(function(){document.body.firstChild?document.body.insertBefore(b.socket,document.body.firstChild):document.body.appendChild(b.socket)}))},buildIframe:function(){var a=document.createElement("iframe"),b=a.style,c=this.env.config.relayFile,c=c+(0>c.indexOf("?")?
"?":"&"),c=c+("injectReturn="+encodeURIComponent(location.href));a.src=c;b.position="absolute";b.visibility="hidden";b.border=0;b.width="1px";b.height="1px";b.left="-5000px";b.top="-5000px";b.opacity="0";return a},sendViaXHR:function(a){var b=this,c=$();c.open("GET",a);c.onreadystatechange=function(){4===c.readyState&&b.resolveCompletedFile(a,c.status,c.responseText)};c.send(null)}}}),ca=p.extend(function(){function a(a,b){window[a]={defineExecutingModuleAs:function(){b.defineExecutingModuleAs.apply(b,
arguments)},undefineExecutingModule:function(){b.undefineExecutingModule.apply(b,arguments)}};return window[a]}function b(a,b,c,e){e=a.module;var m=U?"":"//@ sourceURL="+e.uri;c=[c,m].join("\n");try{eval(c)}catch(l){return l.message="Parse error in "+e.id+" ("+e.uri+") please check for an uncaught error "+l.message,a=document.createElement("script"),a.src=e.uri,a.type="text/javascript",d.appendChild(a),{__error:l}}b.config.sourceUrls?(a=c.replace(/([\w\W]+?)=([\w\W]*\})[\w\W]*?$/,"$1 = ($2)();"),
a=[a,m].join("\n"),eval(a)):a.fn();e.__error&&(e.__error.message="Runtime error in "+e.id+"("+e.uri+") "+e.__error.message)}var c=0,d=!1;try{d=document.getElementsByTagName("head")[0]}catch(e){d=!1}return{init:function(a){this.env=a;this.clearCaches()},clearCaches:function(){this.cache={};this.errors={};this.anonymousAMDStack=[]},defineExecutingModuleAs:function(a,b){return this.anonymousAMDStack.push({id:a,path:b})},undefineExecutingModule:function(){return this.anonymousAMDStack.pop()},getCurrentExecutingAMD:function(){return this.anonymousAMDStack[this.anonymousAMDStack.length-
1]},getFromCache:function(a){var b=this.env.rulesEngine.getOriginalName(a),c,d,e,l;l=/([\d]*)?:([\d]+)\)?$/;E.call(this.errors,a)&&this.errors[a]?c=this.errors[a]:b&&E.call(this.errors,b)&&this.errors[b]&&(c=this.errors[b]);this.cache[a]?d=this.cache[a]:b&&this.cache[b]&&(this.cache[a]=this.cache[b],d=this.cache[b]);if(c)throw a="module "+a+" failed to load successfully"+(c?": "+c.message:""),d&&d.__error_line&&(b=u({e:c}),e=u({e:d.__error_line}),b[1]&&-1!==b[1].indexOf(":")?(d=b[1].match(l),l=e[1].match(l),
"undefined"==typeof d[1]?(l=d[2]-l[2]-1,d="--"):(l=d[1]-l[1]-1,d=d[2]),a=a+" @ Line: "+l+" Column: "+d+" "):a="(unparsable error) "+c.message),c.message=a,c;return d||null},createModule:function(a,b,c){var d;if(!/\!/.test(a)&&this.cache[a])return this.cache[b]=this.cache[a],this.cache[a].qualifiedIds[b]=1,this.cache[a];d={};d.id=a||null;d.qualifiedIds={};d.uri=c||null;d.exports={};d.exec=!1;d.setExports=function(a){for(var b in d.exports)if(Object.hasOwnProperty.call(d.exports,b)){s("cannot setExports when exports have already been set. setExports skipped");
return}switch(typeof a){case "object":for(b in a)d.exports[b]=a[b];break;case "function":d.exports=a;break;default:d.exports=a}};/\!/.test(a)||(this.cache[a]=d,this.cache[a].qualifiedIds[b]=1);this.cache[b]=d;this.cache[b].qualifiedIds[a]=1;return d},getModule:function(a,b){return this.getFromCache(a)||b},runModule:function(d,e){function h(a){return a.replace(/__MODULE_ID__/g,d.id).replace(/__MODULE_URI__/g,d.uri).replace(/__FUNCTION_ID__/g,k).replace(/__REACHABLE_PATH__/g,m)}s("Executor","executing "+
d.uri);var k="exec"+c++,m=this.env.instance+"_"+k,l=a(m,this),q=[],x;for(x in d.qualifiedIds)d.qualifiedIds.hasOwnProperty(x)&&q.push(x);l.module=d;l.require=this.env.requireContext.createRequire(d.id,d.uri,q);l.define=this.env.requireContext.createInlineDefine(d,l.require);q=h("\n__REACHABLE_PATH__.fn = function() {\n  with (window) {\n    __REACHABLE_PATH__.innerFn = function() {\n      // id: __MODULE_ID__ uri: __MODULE_URI__\n      var module = __REACHABLE_PATH__.module,\n          require = __REACHABLE_PATH__.require,\n          define = __REACHABLE_PATH__.define,\n          exports = module.exports;\n      try{module.undefined_function();}catch(e){module.__error_line = e;}");
x=h('\n      __REACHABLE_PATH__.module = module;\n    };\n    __REACHABLE_PATH__.defineExecutingModuleAs("__MODULE_ID__", "__MODULE_URI__");\n    try {\n      __REACHABLE_PATH__.innerFn.call(__REACHABLE_PATH__.module);\n    }\n    catch (__EXCEPTION__) {\n      __REACHABLE_PATH__.module.__error = __EXCEPTION__;\n    }\n    __REACHABLE_PATH__.undefineExecutingModule();\n  }\n};\n');q=[q,";",e,x].join("\n");b(l,this.env,q,k);d.__error&&(s("Executor","broken",d.id,d.uri,d.exports),this.errors[d.id]=
d.__error);delete window[m];s("Executor","executed",d.id,d.uri,d.exports)}}});y=p.extend(function(){var a;return{init:function(b){this._={};this.env={config:{moduleRoot:null,suffixes:!0,sourceUrls:!1,relayFile:null,expires:0},instance:S()};a||(a={Analyzer:aa,Communicator:ba,Executor:ca,RequireContext:H,RulesEngine:da,TreeNode:R,TreeRunner:ea,cache:N&&v?v:null});this.env.analyzer=new a.Analyzer(this.env);this.env.communicator=new a.Communicator(this.env);this.env.executor=new a.Executor(this.env);
this.env.requireContext=new a.RequireContext(this.env);this.env.rulesEngine=new a.RulesEngine(this.env);this.env.TreeNode=a.TreeNode;this.env.TreeRunner=a.TreeRunner;this.env.cache=a.cache;b?this.setModuleRoot(b):(this.require=this.env.requireContext.createRequire(),this.define=this.env.requireContext.createDefine())},setModuleRoot:function(b){this.env.config.moduleRoot=b;this.env.requireContext=new a.RequireContext(this.env);this.require=this.env.requireContext.createRequire(b);this.define=this.env.requireContext.createDefine(b);
return this},setCrossDomain:function(a){this.env.config.relayFile="string"==typeof a?a:a.relayFile;return this},disableSuffixes:function(){this.env.config.suffixes=!1;return this},enableSuffixes:function(){this.env.config.suffixes=!0;return this},setExpires:function(a){this.env.config.expires=a||0;return this},setCacheKey:function(b){var c;if(!a.cache)return!1;c=a.cache.get("!appCacheKey");if(!b&&c||null!==c&&c!==b||null===c&&b)a.cache.flush(),a.cache.set("!appCacheKey",b);return this},reset:function(a){this.env.executor.clearCaches();
a&&this.env.communicator.clearCaches();return this},disableAMD:function(){this.define.amd=!1;return this.define},enableAMD:function(){this.define.amd={};return this.define},enableAMDPlugins:function(){this.env.config.amdPlugins=!0;T(this.env);return this},addModuleRule:function(){this.env.rulesEngine.addModuleRule.apply(this.env.rulesEngine,arguments);return this},addFileRule:function(){this.env.rulesEngine.addFileRule.apply(this.env.rulesEngine,arguments);return this},addContentRule:function(){this.env.rulesEngine.addContentRule.apply(this.env.rulesEngine,
arguments);return this},addFetchRule:function(){this.env.rulesEngine.addFetchRule.apply(this.env.rulesEngine,arguments);return this},addPackage:function(){this.env.rulesEngine.addPackage.apply(this.env.rulesEngine,arguments);return this},enableSourceUrls:function(){this.env.config.sourceUrls=!0;return this},disableSourceUrls:function(){this.env.config.sourceUrls=!1;return this},createContext:function(){return y.createContext.apply(y,arguments)}}});y.createContext=function(a){a=new y(a);return{require:a.require,
define:a.define,Inject:a}};var H=p.extend(function(){return{init:function(a,b,c,d){this.env=a;this.id=b||null;this.path=c||null;this.qualifiedIds=d||[]},log:function(a){s("RequireContext for "+this.path,a)},getPath:function(){if(!this.env.config.moduleRoot)throw Error("moduleRoot must be defined. Please use Inject.setModuleRoot()");return this.path||this.env.config.moduleRoot},getId:function(){return this.id||""},require:function(a,b){var c,d=[],e={},f,g,h,k;if("string"===typeof a){this.log("CommonJS require(string) of "+
a);if(/^[\d]+$/.test(a))throw Error("require() must be a string containing a-z, slash(/), dash(-), and dots(.)");f=this.env.rulesEngine.resolveModule(a,this.getId());g=this.env.requireContext.qualifiedId(f,this.id);d=[f,g];e[f]=1;e[g]=1;h=0;for(k=this.qualifiedIds.length;h<k;h++)g=this.env.requireContext.qualifiedId(f,this.qualifiedIds[h]),e[g]||(d.push(g),e[g]=1);h=0;for(k=d.length;!c&&h<k;h++)c=this.env.executor.getModule(d[h]);if(!c)throw Error("module "+a+" is not available");if(c.__error)throw c.__error;
return c.exports}this.log("AMD require(Array) of "+a.join(", "));var m=[];this.ensure(a,t(function(c){for(var d=0,e=a.length;d<e;d++)switch(a[d]){case "require":m.push(c);break;case "module":case "exports":throw Error("require(array, callback) doesn't create a module. You cannot use module/exports here");default:m.push(c(a[d]))}b.apply(w,m)},this))},ensure:function(a,b){if("[object Array]"!==Object.prototype.toString.call(a))throw Error("require.ensure() must take an Array as the first argument");
this.log("CommonJS require.ensure(array) of "+a.join(", "));a=this.env.analyzer.stripBuiltins(a);var c=t(this.require,this);this.process(a,function(a){"function"==typeof b&&b(c)})},run:function(a){this.log("AMD require.run(string) of "+a);this.ensure([a])},define:function(){var a=Array.prototype.slice.call(arguments,0),b=null,c=["require","exports","module"],d=!1,e={},f={"string array object":["id","dependencies","factory"],"string object":["id","factory"],"array object":["dependencies","factory"],
object:["factory"]},g=[],h;h=0;for(len=a.length;h<len;h++)"[object Array]"===Object.prototype.toString.apply(a[h])?g.push("array"):"object"===typeof a[h]||"function"===typeof a[h]?g.push("object"):g.push(typeof a[h]);g=g.join(" ");if(!f[g])throw Error("You did not use an AMD compliant interface. Please check your define() calls");g=f[g];h=0;for(len=g.length;h<len;h++)switch(f=a[h],g[h]){case "id":b=f;break;case "dependencies":c=f;d=!0;break;case "factory":e=f}if(!b){if(currentExecutingAMD=this.env.executor.getCurrentExecutingAMD())b=
currentExecutingAMD.id;else throw Error("Anonymous AMD module used, but it was not included as a dependency. This is most often caused by an anonymous define() from a script tag.");this.log("AMD identified anonymous module as "+b)}this.process(b,c,function(a){if(a.data.resolvedId){var b=[],f=d?c:["require","exports","module"],g=this.env.requireContext.createRequire(a.data.resolvedId,a.data.resolvedUrl);a=this.env.executor.createModule(a.data.resolvedId,this.env.requireContext.qualifiedId(a),a.data.resolvedUrl);
for(var h=0,n=f.length;h<n;h++)switch(f[h]){case "require":b.push(g);break;case "module":b.push(a);break;case "exports":b.push(a.exports);break;default:b.push(g(f[h]))}if("function"===typeof e){if(b=e.apply(a,b))a.exports=b}else"object"===typeof e&&(a.exports=e);a.amd=!0;a.exec=!0}})},process:function(a,b,c){var d,e;"string"!==typeof a?(d=this.id,e=b):(d=a,a=b,e=c);var f=new this.env.TreeNode,g=a.length,h;b=[];var k=this;c=function(){if(0===g||0===--g)h=new k.env.TreeRunner(k.env,f),h.execute(function(){e.call(k,
f)})};f.data.originalId=d;f.data.resolvedId=d;f.data.resolvedUrl=this.env.rulesEngine.resolveFile(d,this.path);if(a.length)for(i=0,len=a.length;i<len;i++)K[a[i]]?c():(d=new this.env.TreeNode,d.data.originalId=a[i],f.addChild(d),this.env.executor.getModule(a[i])?c():this.env.executor.getModule(this.env.requireContext.qualifiedId(this.env.rulesEngine.resolveModule(d.data.originalId,f.data.resolvedId),d))?c():(h=new this.env.TreeRunner(this.env,d),b.push(h),h.download(c)));else c()},createRequire:function(a,
b,c){b=new H(this.env,a,b,c);c=t(b.require,b);var d=this;c.ensure=t(b.ensure,b);c.run=t(b.run,b);c.toUrl=function(b){b=d.env.rulesEngine.resolveModule(b,a);return d.env.rulesEngine.resolveFile(b,"",!0)};return c},createDefine:function(a,b,c){a=new H(this.env,a,b);a=t(a.define,a);a.amd=c?!1:{};return a},qualifiedId:function(a,b){var c=[];if("string"===typeof a)return b?[a,b].join("(from)"):a;a.parents(function(a){a.data.resolvedId&&c.push(a.data.resolvedId)});return c.join("(from)")},createInlineDefine:function(a,
b){var c=function(){for(var c=[],e=["require","exports","module"],f={},f=0,g=arguments.length;f<g;f++)if("[object Array]"===Object.prototype.toString.call(arguments[f])){e=arguments[f];break}for(var f=arguments[arguments.length-1],g=0,h=e.length;g<h;g++)switch(e[g]){case "require":c.push(b);break;case "module":c.push(a);break;case "exports":c.push(a.exports);break;default:c.push(b(e[g]))}if("function"===typeof f){if(c=f.apply(a,c))a.exports=c}else"object"===typeof f&&(a.exports=f);a.amd=!0;a.exec=
!0};c.amd={};return c}}}),da=p.extend(function(){return{init:function(a){this.env=a;this.clearRules()},clearRules:function(){this.moduleRules=[];this.fileRules=[];this.contentRules=[];this.fetchRules=[];this.aliasRules={};this.revAliasRules={};this.dirty={moduleRules:!0,fileRules:!0,contentRules:!0,fetchRules:!0,aliasRules:!0,revAliasRules:!0};this.caches={moduleRules:{},fileRules:{},contentRules:{},fetchRules:{},aliasRules:{},revAliasRules:{}};this.addRuleCounter=0;this.addRulePointcuts={}},add:function(a,
b,c,d){this.dirty[a]=!0;d=d||{};this[a].push({matches:b,fn:"function"===typeof c?c:function(){return c},weight:d.weight||this[a].length,last:d.last||!1,all:d})},clearCache:function(a){this.caches[a]={}},sort:function(a){this.dirty[a]&&(this.clearCache(a),this[a].sort(function(a,c){return c.weight-a.weight}),this.dirty[a]=!1)},getDeprecatedPointcuts:function(a){return this.addRulePointcuts[a]||[]},addRule:function(a,b,c){c||(c=b);c||(c={});"string"===typeof c&&(c={path:c});c.weight||(c.weight=this.addRuleCounter++);
c.path?this.addFileRule(a,c.path,{weight:c.weight,last:c.last,useSuffix:c.useSuffix,afterFetch:c.pointcuts&&c.pointcuts.afterFetch?c.pointcuts.afterFetch:null}):c.pointcuts&&c.pointcuts.afterFetch&&this.addContentRule(a,c.pointcuts.afterFetch,{weight:c.weight})},addModuleRule:function(a,b,c){return this.add("moduleRules",a,b,c)},addFileRule:function(a,b,c){return this.add("fileRules",a,b,c)},addContentRule:function(a,b,c){return this.add("contentRules",a,b,c)},addFetchRule:function(a,b,c){return this.add("fetchRules",
a,b,c)},addPackage:function(a,b){this.dirty.aliasRules=!0;if(this.revAliasRules[a])throw Error("An alias can only map back to 1 origin");this.aliasRules[a]||(this.aliasRules[a]=[]);this.aliasRules[a].push(b);this.revAliasRules[b]=a},resolveModule:function(a,b){a=a||"";b=b||"";this.sort("moduleRules");var c=a,d=0,e=this.moduleRules,f=e.length,g=!1,h,k;for(d;d<f&&(h=e[d].matches,k=e[d].fn,g=!1,"string"===typeof h?h===a&&(g=!0):"function"===typeof h.test&&(g=h.test(a)),!g||(c=k(c),!h.last));d++);c=c.replace(O,
"");0!==c.indexOf(".")&&(b=null);b&&(d=b.split("/"),d.pop(),b=d=d.join("/"));c=this.getRelative(c,b);c=c.replace(O,"");return this.caches.moduleRules[a]=c},resolveFile:function(a,b,c){a=a||"";b=b||"";this.sort("fileRules");var d=a,e=0,f=this.fileRules,g=f.length,h=!1,k,m,l=this.env,q=[];for(e;e<g&&(k=f[e].matches,m=f[e].fn,h=!1,"string"===typeof k?k===a&&(h=!0):"function"===typeof k.test&&(h=k.test(a)),!h||(d=m(d),f[e].all&&f[e].all.afterFetch&&q.push(f[e].all.afterFetch),!f[e].last));e++);l.config.moduleRoot||
"undefined"==typeof console||"function"!=typeof console.log||console.log("Without moduleRoot defined, Inject will default to the URL of the current page. This may cause unexpected behavior");if(!d)return this.addRulePointcuts[d]=q,this.caches.fileRules[a]=d;b&&!l.config.baseDir?(b=b.replace(F,"__INJECT_PROTOCOL_COLON_SLASH_SLASH__").split("/"),b[b.length-1]&&1!==b.length&&b.pop(),b=b.join("/").replace(M,"://")):b=b?l.config.baseDir(b):l.config.moduleRoot?l.config.moduleRoot:location.pathname;if(L.test(d))return this.caches.fileRules[a]=
d;b=b.replace(F,"__INJECT_PROTOCOL_COLON_SLASH_SLASH__");d=d.replace(F,"__INJECT_PROTOCOL_COLON_SLASH_SLASH__");d=/\?/.test(b)?b+d:this.getRelative(d,b);d=d.replace(M,"://");c||!l.config.suffixes||V.test(d)||(d+=".js");this.addRulePointcuts[d]=q;return this.caches.fileRules[a]=d},getAliases:function(a){return this.aliasRules[a]||[]},getOriginalName:function(a){return this.revAliasRules[a]||null},getFetchRules:function(a){this.sort("fetchRules");var b=0,c=this.fetchRules,d=c.length,e=!1,f,g,h=[];for(b;b<
d;b++)f=c[b].matches,g=c[b].fn,e=!1,"string"===typeof f?f===a&&(e=!0):"function"===typeof f.test&&(e=f.test(a)),e&&h.push(g);return this.caches.contentRules[a]=h},getContentRules:function(a){this.sort("contentRules");var b=0,c=this.contentRules,d=c.length,e=!1,f,g,h=[],k=!1,m=this.addRulePointcuts[a]||[];for(b;b<d;b++)f=c[b].matches,g=c[b].fn,e=!1,"string"===typeof f?f===a&&(e=!0):"function"===typeof f.test&&(e=f.test(a)),e&&h.push(g);D(m,function(a){k=!1;D(h,function(b){b===a&&(k=!0)});k||h.push(a)});
return this.caches.contentRules[a]=h},getRelative:function(a,b){var c,d=[],e,f,g;b=b||"";if(L.test(a))return a;0===a.indexOf("/")&&(b="");c=[];if(b.length)for(f=0,e=b.split("/"),g=e.length;f<g;f++)c.push(e[f]);f=0;e=a.split("/");for(g=e.length;f<g;f++)c.push(e[f]);f=0;for(g=c.length;f<g;f++)if(e=c[f],!("."===e||""===e&&0<f))if(".."===e){if(0===d.length)throw Error("could not traverse higher than highest path: "+a+", "+b);d.pop()}else d.push(e);return d=d.join("/")}}}),R=p.extend(function(){return{init:function(){this.data=
{};this.children=[];this.parent=this.right=this.left=null},addChild:function(a){var b;0<this.children.length&&(b=this.children[this.children.length-1],a.setLeft(b),b.setRight(a));this.children.push(a);return a.setParent(this)},getChildren:function(){return this.children},setLeft:function(a){return this.left=a},getLeft:function(){return this.left},setRight:function(a){return this.right=a},getRight:function(){return this.right},setParent:function(a){return this.parent=a},getParent:function(){return this.parent},
parents:function(a){for(var b=[],c=this;c;)a&&a(c),b.push(c),c=c.getParent();return b},postOrder:function(a){for(var b=this,c=null,d=[];b;)if(0<b.getChildren().length&&"up"!==c)c="down",b=b.getChildren()[0];else if(d.push(b),a&&a(b),b.getRight())c="right",b=b.getRight();else if(b.getParent())c="up",b=b.getParent();else return d}}}),ea=p.extend(function(){var a=function(){function a(){var b=d;d=[];e=!1;for(fn=b.shift();fn;)fn(),fn=b.shift()}function c(a){d.push(a);e||(e=!0,f())}var d=[],e=!1,f,g;window.postMessage?
(f=function(){window.postMessage("inject-nexttick","*")},g=function(c){c.source==window&&"inject-nexttick"===c.data&&(c.stopPropagation?c.stopPropagation():c.returnValue=!1,a())},c.listener=z(window,"message",g,!0)):(f=function(){window.setTimeout(function(){g()},0)},g=a);c.removeListener=function(){G(window,"message",g,!0)};return c}();return{init:function(a,c){this.env=a;this.root=c},download:function(a){var c=this.root,d=this,e=c.data,f=c.getParent();e.resolvedId=f?this.env.rulesEngine.resolveModule(e.originalId,
f.data.resolvedId):this.env.rulesEngine.resolveModule(e.originalId,"");e.resolvedUrl=this.env.rulesEngine.resolveFile(e.resolvedId);this.buildCommunicator(c)(e.originalId,e.resolvedUrl,function(g){var h=d.env.rulesEngine.getContentRules(e.resolvedUrl),k=new Q,m=0,l=h.length;addContent=function(a){k.seq(function(b,c,d){try{a(function(a){b(null,a)},d)}catch(e){b(e,d)}})};k.seq(function(a){a(null,g)});for(m;m<l;m++)addContent(h[m]);k.seq(function(g,h,k){g=!1;h={};var l=f;"string"===typeof k?e.file=k:
e.exports=k;for(h[e.originalId]=!0;l&&!g;)h[l.data.originalId]?g=!0:(h[l.data.originalId]=!0,l=l.getParent());e.circular=g;e.exports?(g=d.env.executor.createModule(e.resolvedId,d.env.requireContext.qualifiedId(c),e.resolvedUrl),g.exec=!0,g.exports=k,a()):e.circular?a():d.downloadDependencies(c,t(a,d))})})},execute:function(a){var c=this.root.postOrder(),d=c.length,e=0;for(e;e<d;e++){var f=c[e],g=f.data,h=void 0;g.resolvedId&&(h=this.env.executor.createModule(g.resolvedId,this.env.requireContext.qualifiedId(f),
g.resolvedUrl),g.module=h,h.exec||g.circular||(g.exports?(h.exports=g.exports,h.exec=!0):"string"===typeof g.file&&(this.env.executor.runModule(h,g.file),h.exec=!0,h.amd||(g.exports=h.exports))))}a()},buildCommunicator:function(a){var c=a.data,d=this,e=a.getParent()?a.getParent().data:null,f=this.env.rulesEngine.getFetchRules(c.resolvedId),g=new Q,h={module:function(){return d.env.rulesEngine.resolveModule.apply(d.env.rulesEngine,arguments)},url:function(){return d.env.rulesEngine.resolveFile.apply(d.env.rulesEngine,
arguments)}},k={get:function(){return d.env.communicator.get.apply(d.env.communicator,arguments)}},m=function(a){g.seq(function(b,d,f){function g(a,c){b(null,c)}try{a(g,f,h,k,{moduleId:c.originalId,parentId:e?e.originalId:"",parentUrl:e?e.resolvedUrl:""})}catch(m){b(m,f)}})};return-1===c.resolvedId.indexOf("!")&&(this.env.executor.getModule(c.resolvedId)||this.env.executor.getModule(this.env.requireContext.qualifiedId(a)))?function(a,b,c){c("")}:0<f.length?function(a,b,c){a=0;b=f.length;g.seq(function(a){a(null,
"")});for(a;a<b;a++)m(f[a]);g.seq(function(a,b,d){c(d)})}:t(this.env.communicator.get,this.env.communicator)},downloadDependencies:function(b,c){var d=this.env.analyzer.extractRequires(b.data.file),e=d.length,f=0,g=e,h,k=function(){e--;0===e&&c()},m=function(b){a(function(){b.download(k)})};if(!d.length)return c();for(f;f<g;f++)h=new R,h.data.originalId=d[f],b.addChild(h),this.env.executor.getModule(d[f])&&this.env.executor.getModule(d[f]).exec?k():(h=new this.env.TreeRunner(this.env,h),m(h))}}});
(function(a){var b=y.createContext();w.require=b.require;w.define=b.define;w.Inject=b.Inject;w.Inject.version=a})("0.7.0")})(this);
