define(["./helpers"],function(d){var h=d.merge,f=d.isString,g=d.isPlainObject;d=function(a,b){this.uri=b;this.matchedRoute="";this.targets=[];this.actions=[];this.exits=[];this.options={};this.match(a);this.uri=b};d.prototype={match:function(a){var b,c;a.target&&this.targets.push(a.target);this.targets.length&&(b=this.targets[this.targets.length-1]);c={target:b,method:null};for(var e in a)a.hasOwnProperty(e)&&(b=a[e],this.isFragment(e)&&this.isFragmentInURI(e)&&(this.updateMatchedRoute(e),this.removeFragmentFromURI(e),
this.isActionDescriptor(b)?this.isNamedParam(e)&&c.method||(f(b)?c.method=b:(c.method=b.method,b.exit&&this.exits.unshift({method:b.exit,target:a.target}),b.options&&this.mergeOptions(b.options)),this.actions.push(c)):b.hasOwnProperty("options")&&this.mergeOptions(b.options),g(b)&&this.match(b)))},mergeOptions:function(a){this.options=h(this.options,a)},updateMatchedRoute:function(a){"/"!==a&&"/*"!==a&&(this.matchedRoute+=a)},removeFragmentFromURI:function(a){var b=this.uri,c;"/"!==a&&"/*"!==a&&(this.includesNamedParam(a)?
(c=b.split("/"),a=a.split("/"),a.forEach(function(a,d){0===a.indexOf(":")?b=b.replace("/"+c[d],""):a&&(b=b.replace("/"+a,""))})):b=b.replace(a,""));this.uri=b},isFragmentInURI:function(a){var b=this.uri,c;return"/"===b||""===b?"/"===a||"/*"===a:"/"===a?!1:"/*"===a?!0:this.includesNamedParam(a)?(c=b.split("/"),a=a.split("/"),2===a.length?!0:a.map(function(a,b){return 0===a.indexOf(":")?!0:-1!==c[b].indexOf(a)}).reduce(function(a,b){return a&&b})):0===b.indexOf(a)},includesNamedParam:function(a){return-1!==
a.indexOf("/:")},isFragment:function(a){return 0===a.indexOf("/")},isActionDescriptor:function(a){return f(a)||g(a)&&a.method},isNamedParam:function(a){return 0===a.indexOf("/:")}};return d});
