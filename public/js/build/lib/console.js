/** @jsx React.DOM */define(["./console.leftpanel","./console.rightpanel","./console.map","../lib/console.component.schedule.js","../lib/console.component.router.js","../lib/console.component.map.js","../lib/console.component.queries.js"],function(e,t,n,r,i,s,o){function p(e){while(e.length>0)e.pop()}function d(e){return e?_.isString(e)?e:_.isArray(e)?e.join(","):"":""}var u=pager.Aviator,a,f,l,c,h;return LazyLoad.css([pager.build.css.console]),f=React.createClass({displayName:"UserLink",render:function(){return this.props.user.url?React.DOM.a({target:"_blank",title:this.props.user.full_name,href:this.props.user.url},this.props.user.short_name):React.DOM.strong({title:this.props.user.full_name},this.props.user.short_name)}}),h=React.createClass({displayName:"ObjectLink",render:function(){return React.DOM.span(null,this.props.object.adj?" "+this.props.object.adj:null,React.DOM.span(null," "),this.props.object.url?React.DOM.a({target:"_blank",href:this.props.object.url},this.props.object.name):React.DOM.strong(null,this.props.object.name))}}),c=React.createClass({displayName:"AttrItem",toggleTb:function(){$(this.getDOMNode()).closest(".attr-table").find(".row").not(".main-attr").toggle()},render:function(){var e=this.props.attr,t=React.addons.classSet({row:!0,"main-attr":e.relevance===3,"important-attr":e.relevance===2}),n=e.relevance===3&&_.isString(e.value)?e.value.toUpperCase():e.value,r=e.relevance!==3&&e.descr,i=React.addons.classSet({columns:!0,"small-8":r,"small-12":!r});return React.DOM.div({className:t,onClick:e.relevance===3?this.toggleTb:null},r?React.DOM.div({className:"small-4 columns"},e.descr):null,React.DOM.div({className:i,title:!r&&e.descr?e.descr:""},e.url?React.DOM.a({href:e.url,target:"_blank"},n):n))}}),l=React.createClass({displayName:"AttrTable",render:function(){var e=_.filter(this.props.attrs,{relevance:3}).concat(_.filter(this.props.attrs,{relevance:2})).concat(_.filter(this.props.attrs,function(e){return!e.relevance||e.relevance<=1}));return React.DOM.div({className:"attr-table"},e.map(function(e,t){return c({key:t,attr:e})}))}}),a=React.createClass({displayName:"Console",parseArgsToState:function(e){return e=e||this.props,{day:e.args.day?e.args.day:(new Date).toYMD(),locations:d(e.args.locations?e.args.locations:[])}},getInitialState:function(){var e,t=_.merge(this.parseArgsToState(),{mapState:pager.constant.console.map.AVAILABLE_TASKS,pending:[],queries:[],schedule:[]});if(Modernizr.localstorage){try{e=JSON.parse(localStorage.getItem("pager."+pager.org.id+".console.queries"))}catch(n){console.log(n)}t.queries=e&&e.length?t.queries.concat(e):t.queries}return t},componentWillReceiveProps:function(e){var t=e.args.day&&e.args.day!==this.state.day;this.setState(this.parseArgsToState(e),function(){t&&(p(this.state.schedule),this.updateSchedule()),this.updateDefaultQuery(t)}.bind(this))},componentDidMount:function(){$("body").css("overflow-y","scroll"),this.updateDefaultQuery(!0),this.putArgs();var e=_.throttle(function(){if(!this.isMounted())return $(window).off("resize",e);this.setState({myHeight:$(window).height()-$("#MainTopBar").outerHeight()})}.bind(this),300);$(window).on("resize",e),this.updateSchedule(this.syncQueries),this.loadGoogleMaps()},componentWillUnmount:function(){$("body").css("overflow-y",""),clearTimeout(this.updateSchedule.__timeout),clearTimeout(this.syncQueries.__timeout)},putArgs:function(){var e=[pager.org.id,"console",this.state.day,this.state.locations],t;t="/"+e.join("/"),t!==u.getCurrentURI()&&u.navigate(t)},setTaskFocus:s.setTaskFocus,setMapState:s.setMapState,loadGoogleMaps:s.loadGoogleMaps,updateDefaultQuery:o.updateDefaultQuery,setQueries:o.setQueries,fetchQuery:o.fetchQuery,fetchQueries:o.fetchQueries,syncQueries:o.syncQueries,toggleRouterMode:i.toggleRouterMode,killRoute:i.killRoute,saveRoute:i.saveRoute,cancelRoute:i.cancelRoute,startRouter:i.startRouter,initRouter:i.initRouter,updateSchedule:r.updateSchedule,render:function(){var r=this.state.myHeight||$(window).height()-$("#MainTopBar").outerHeight(),i={"min-height":r};return React.DOM.div({id:"Console",style:i},this.state.hasGoogleMaps?n({queries:this.state.queries,setTaskFocus:this.setTaskFocus,routerWorker:this.state.routerWorker,mapState:this.state.mapState,height:r,setMapState:this.setMapState,selectedTask:this.state.selectedTask}):null,e({pending:this.state.pending,routeTasks:this.initRouter,queries:this.state.queries,toggleRouterMode:this.toggleRouterMode,saveRoute:this.saveRoute,cancelRoute:this.cancelRoute,day:this.state.day,router:this.state.router,locations:this.state.locations,hasGoogleMaps:this.state.hasGoogleMaps,setQueries:this.setQueries,selectedTask:this.state.selectedTask,setTaskFocus:this.setTaskFocus}),t({router:this.state.router,updateSchedule:this.updateSchedule,syncQueries:this.syncQueries,schedule:this.state.schedule,day:this.state.day,totalWidth:$(window).width(),routerLoader:this.state.routerLoader,hasGoogleMaps:this.state.hasGoogleMaps}))}}),_.merge(pager.components,{UserLink:f,ObjectLink:h,AttrTable:l}),pager.console={},a});