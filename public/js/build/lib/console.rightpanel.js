define(["./console.schedule"],function(h){var k=React.createClass({displayName:"RightPanelToolbar",getInitialState:function(){return{CSVDataURI:null}},componentDidMount:function(){$(this.getDOMNode()).foundation();$(this.refs.cleanEmAll.getDOMNode()).on("click",this.props.emptySchedule)},exportToCSV:function(){function e(a){return(_.isDate(a)?a:new Date(a)).toLocaleString()}function c(a){_.isString(a)||(a=""+a);a=a.replace(/"/g,'""');return 0<=a.search(/("|,|\n)/g)?'"'+a+'"':a}var d,g,f;d="In\u00edcio estimado;Fim estimado;Encarregado;Tipo Ordem;Refer\u00eancia;Refer\u00eancia:::Tipo;Refer\u00eancia:::ID;Deslocamento;Endere\u00e7o".split(";").map(c).join(",")+
"\n";g=_.flatten(_.map(this.props.schedule,function(a){return _.map(a.tasks,function(c){return _.merge({worker:a.worker},c)})}));g.forEach(function(a,f){var b=[];b.push(e(a.schedule.ini));b.push(e(a.schedule.end));b.push(a.worker.name);b.push(_.uniq(a.work_orders.map(function(a){return a.type})).join(", "));a.target&&a.target.name?b.push(a.target.name):b.push("---");a.target&&a.target.type?b.push(a.target.type):b.push("---");a.target&&a.target.sys_id?b.push(a.target.sys_id):b.push("---");a.directions?
b.push(a.directions.distance.text+" | "+a.directions.duration.text):b.push("---");b.push(a.address.address);b=b.map(c).join(",");d+=f<g.length?b+"\n":b});f=new Blob([d],{type:"text/csv"});this.setState({CSVDataURI:URL.createObjectURL(f)})},cleanCSV:function(){this.setState({CSVDataURI:null})},render:function(){return React.DOM.div({id:"RightPanelToolbar"},React.DOM.div({className:"row"},React.DOM.div({className:"small-12 columns"},this.state.CSVDataURI?React.DOM.a({className:"button success small",
href:this.state.CSVDataURI,download:"Extra\u00e7\u00e3o-Pager-"+(new Date).toLocaleString()+".csv",onClick:this.cleanCSV},"Baixar"):React.DOM.button({className:"button secondary small",onClick:this.exportToCSV},"Exportar"),React.DOM.a({"data-dropdown":"RightPanelToolbarDropDown",className:"button secondary small dropdown"},"Op\u00e7\u00f5es"))),React.DOM.ul({id:"RightPanelToolbarDropDown","data-dropdown-content":!0,className:"f-dropdown"},React.DOM.li(null,React.DOM.a({ref:"cleanEmAll"},"Limpar"))))}});
return React.createClass({displayName:"RightPanel",getInitialState:function(){return{contentVisible:!0}},componentDidMount:function(){var e=_.throttle(function(){if(!this.isMounted())return $(["#Console",window]).off("resize",e);var c=$(this.getDOMNode());c&&$("#Console").width()-$("#LeftPanel").width()!==c.width()&&this.forceUpdate()}.bind(this),100);$(["#Console",window]).on("resize",e)},toggleContent:function(){this.setState({contentVisible:!this.state.contentVisible})},cleanScheduleAndUpdate:function(){$.ajax({type:"DELETE",
url:pager.urls.ajax+"console/schedule/"+this.props.day}).done(function(){this.props.updateSchedule();this.props.syncQueries()}.bind(this))},render:function(){var e=pager.components.RouterCfg,c={},d=this.state.contentVisible&&(this.props.schedule.length||this.props.routerLoader);d&&(c.width=$("#Console").width()-$("#LeftPanel").width());return React.DOM.main({id:"RightPanel",style:c},d?React.DOM.div({id:"RightPanelContent"},this.props.routerLoader?React.DOM.div(null,React.DOM.h4(null,"Configura\u00e7\u00f5es de Roteamento"),
React.DOM.div({className:"panel"},e({day:this.props.routerLoader._day,onSet:this.props.routerLoader}))):null,this.props.schedule.length?h({schedule:this.props.schedule}):null,this.props.schedule.length?k({schedule:this.props.schedule,emptySchedule:this.cleanScheduleAndUpdate}):null):null,this.props.schedule.length||this.props.routerLoader?React.DOM.div({id:"ToggleRightPanel",className:React.addons.classSet({lonesome:!d})},React.DOM.i({onClick:this.toggleContent,className:"fi-arrows-expand"})):null)}})});
