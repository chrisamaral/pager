/** @jsx React.DOM */define(["./console.schedule"],function(e){var t=React.createClass({displayName:"RightPanelToolbar",getInitialState:function(){return{CSVDataURI:null}},componentDidMount:function(){$(this.getDOMNode()).foundation(),$(this.refs.cleanEmAll.getDOMNode()).on("click",this.props.emptySchedule)},exportToCSV:function(){function e(e){var t=_.isDate(e)?e:new Date(e);return t.toLocaleString()}function t(e){return _.isString(e)||(e=""+e),e=e.replace(/"/g,'""'),e.search(/("|,|\n)/g)>=0?'"'+e+'"':e}var n,r,i;n=["Início estimado","Fim estimado","Encarregado","Tipo Ordem","Referência","Referência:::Tipo","Referência:::ID","Deslocamento","Endereço"].map(t).join(",")+"\n",r=_.flatten(_.map(this.props.schedule,function(e){return _.map(e.tasks,function(t){return _.merge({worker:e.worker},t)})})),r.forEach(function(i,s){var o=[];o.push(e(i.schedule.ini)),o.push(e(i.schedule.end)),o.push(i.worker.name),o.push(_.uniq(i.work_orders.map(function(e){return e.type})).join(", ")),i.target&&i.target.name?o.push(i.target.name):o.push("---"),i.target&&i.target.type?o.push(i.target.type):o.push("---"),i.target&&i.target.sys_id?o.push(i.target.sys_id):o.push("---"),i.directions?o.push(i.directions.distance.text+" | "+i.directions.duration.text):o.push("---"),o.push(i.address.address),o=o.map(t).join(","),n+=s<r.length?o+"\n":o}),i=new Blob([n],{type:"text/csv"}),this.setState({CSVDataURI:URL.createObjectURL(i)})},cleanCSV:function(){this.setState({CSVDataURI:null})},render:function(){return React.DOM.div({id:"RightPanelToolbar"},React.DOM.div({className:"row"},React.DOM.div({className:"medium-12 columns"},this.state.CSVDataURI?React.DOM.a({className:"button success small",href:this.state.CSVDataURI,download:"Extração-Pager-"+(new Date).toLocaleString()+".csv",onClick:this.cleanCSV},"Baixar"):React.DOM.button({className:"button secondary small",onClick:this.exportToCSV},"Exportar"),React.DOM.a({"data-dropdown":"RightPanelToolbarDropDown",className:"button secondary small dropdown"},"Opções"))),React.DOM.ul({id:"RightPanelToolbarDropDown","data-dropdown-content":!0,className:"f-dropdown"},React.DOM.li(null,React.DOM.a({ref:"cleanEmAll"},"Limpar"))))}}),n=React.createClass({displayName:"RightPanel",getInitialState:function(){return{contentVisible:!0,myWidth:null}},componentDidMount:function(){var e=_.throttle(function(){if(!this.isMounted())return $(["#Console",window]).off("resize",e);var t=$(this.getDOMNode());this.isMounted()&&t&&$("#Console").width()-$("#LeftPanel").width()!==t.width()&&this.setState({myWidth:$("#Console").width()-$("#LeftPanel").width()})}.bind(this),100);$(["#Console",window]).on("resize",e)},toggleContent:function(){this.setState({contentVisible:!this.state.contentVisible})},cleanScheduleAndUpdate:function(){$.ajax({type:"DELETE",url:pager.urls.ajax+"console/schedules/"+this.props.day}).done(function(){this.props.updateSchedule(),this.props.syncQueries()}.bind(this))},render:function(){var n=pager.components.RouterCfg,r={},i=this.state.contentVisible&&(this.props.schedule.length||this.props.routerLoader);return i&&(r.width=this.state.myWidth||$("#Console").width()-$("#LeftPanel").width()),React.DOM.main({id:"RightPanel",style:r},i?React.DOM.div({id:"RightPanelContent"},this.props.routerLoader?React.DOM.div(null,React.DOM.h3({className:"controlTitle"},"Configurações de Roteamento"),React.DOM.div({className:"panel"},n({day:this.props.routerLoader._day,onSet:this.props.routerLoader}))):null,this.props.schedule.length?e({schedule:this.props.schedule,day:this.props.day,syncQueries:this.props.syncQueries,updateSchedule:this.props.updateSchedule}):null,this.props.schedule.length?t({schedule:this.props.schedule,emptySchedule:this.cleanScheduleAndUpdate}):null):null,this.props.schedule.length||this.props.routerLoader?React.DOM.div({id:"ToggleRightPanel",className:React.addons.classSet({lonesome:!i})},React.DOM.i({onClick:this.toggleContent,className:"fi-arrows-expand"})):null)}});return n});