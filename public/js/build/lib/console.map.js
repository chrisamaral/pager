var drawQueue=[];
define(function(){return React.createClass({displayName:"Map",getInitialState:function(){return{markedTasks:[]}},massTaskMarker:_.debounce(function(){if("tasks"===this.props.mapState){var a=this.state.markedTasks,b=_.findIndex(a,function(a){void 0===a.marker&&void 0===a.location&&console.log(a);return void 0===a.marker&&void 0!==a.location});if(b=a[b])b.marker=new google.maps.Marker({map:pager.console.map,position:new google.maps.LatLng(b.location.lat,b.location.lng)}),this.setState({markedTasks:a}),this.massTaskMarker()}},
50),filterExistingTasks:function(a){var b=[],d=this.state.markedTasks;a.queries.forEach(function(a){a.tasks.forEach(function(a){if(a.location){var c={id:a.id},e=_.findIndex(d,c),f=d[e];c.location=c.location||a.location;f&&f.marker&&(c.marker=f.marker);b.push(c);0<=e&&d.splice(e,1)}}.bind(this))}.bind(this));d.forEach(function(a){a.marker&&a.marker.setMap(null)});return b},updateMapView:_.debounce(function(a){var b=a||this.props;a=this.filterExistingTasks(b);console.log("update map view");"tasks"===
b.mapState?this.setState({markedTasks:a},function(){this.massTaskMarker()}.bind(this)):"task"===b.mapState&&(a=a.map(function(a){a.marker&&(a.marker.setMap(null),delete a.marker);return a}),(b=_.find(a,{id:b.selectedTask}))?b.marker=new google.maps.Marker({map:pager.console.map,position:new google.maps.LatLng(b.location.lat,b.location.lng)}):this.props.setMapState("tasks"),this.setState({markedTasks:a}))},100),componentDidMount:function(){var a={zoom:8,center:new google.maps.LatLng(-22.848658,-43.300933),
zoomControl:!1,panControl:!1,scaleControl:!1,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM}};pager.console=pager.console||{};pager.console.map=new google.maps.Map(this.getDOMNode(),a);setTimeout(function(){this.updateMapView()}.bind(this),1E3)},componentWillReceiveProps:function(a){this.updateMapView(a)},render:function(){return React.DOM.div({id:"ConsoleMainMap"})}})});
