var lastLookup=Date.now();define(function(){function e(e){if(!e||!e.components)return null;var t=null;return e.components.forEach(function(e){t=t||{},e&&e.name&&e.value&&(t[e.name]=e.value)}),t}function t(e){this.status="OK";var t=e.concat();this.init=function(){this.processGeoQueue(t)}}return t.prototype.abort=function(){console.log("will abort lookup"),this.status="Aborted"},t.prototype.processGeoQueue=function(t){function r(i){if(n.status.toLowerCase()==="aborted")return;var s=i.splice(0,1),o,u=function(){Date.now()-lastLookup>1100?r(i):setTimeout(u,100)};if(!s.length)return n.onComplete();s=s[0];if(s.location)return _.isFunction(n.onProgress)&&n.onProgress(t.length-i.length,t.length,s,"unchanged"),u();o=new google.maps.Geocoder;var a={address:s.address.address},f=e(s.address);f&&(a.componentRestrictions={},f.city&&(a.componentRestrictions.locality=f.city),f.country&&(a.region=f.country,a.componentRestrictions.country=f.country),f.state&&(a.componentRestrictions.administrativeArea=f.state)),console.log("searching",a.address),lastLookup=Date.now(),o.geocode(a,function(e,r){var o,a;r===google.maps.GeocoderStatus.OK?(o=e[0].geometry.location.lat(),a=e[0].geometry.location.lng(),s.location={lat:o,lng:a},_.isFunction(n.onProgress)&&n.onProgress(t.length-i.length,t.length,s),$.post(pager.urls.ajax+"workOrder/"+s._id+"/location",s.location)):console.log("Geocode failure: "+r),u()})}var n=this;r(t.concat())},t});