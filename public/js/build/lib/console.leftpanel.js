/** @jsx React.DOM */define(["./../lib/component.DateInput.js","./console.queue","./console.tasks","../ext/strftime"],function(e,t,n,r){var i=pager.Aviator,s=React.createClass({displayName:"RouterWorker",drawMe:function(){if(!this.props.worker.tasks.length)return;this.props.drawWorkerDirections(this.props.worker._id)},render:function(){return React.DOM.tr(null,React.DOM.td(null,this.props.worker.name),React.DOM.td(null,this.props.worker.tasks?this.props.worker.tasks.length:"0"),React.DOM.td(null,this.props.worker.tasks&&this.props.worker.tasks.length?React.DOM.a({className:"radius ico fi-map",onClick:this.drawMe}):null))}}),o=React.createClass({displayName:"RouterWorkers",drawWorkerDirections:function(e){this.props.workers.forEach(function(t){if(!t.tasks.length)return;if(t._id!==e||!t.drawDirections()){t._id!==e&&t.cleanDirections(),t._id===e&&this.props.toggleRouterMode(null);return}this.props.toggleRouterMode(t._id,t.tasks.map(function(e){if(!e.schedule)return;var n=[{relevance:3,value:t.name},{descr:"Tipos",value:_.uniq(e.types).join(", ")},{descr:"Deslocamento",value:r("%H:%M",e.directions.schedule.ini)+" < "+e.directions.duration.text+" - "+e.directions.distance.text+" > "+r("%H:%M",e.directions.schedule.end)},{descr:"Execução",value:r("%H:%M",e.schedule.ini)+" < "+Math.floor(e.duration/1e3/60)+"min"+" > "+r("%H:%M",e.schedule.end)},{descr:"Duração",value:Math.floor(e.duration/1e3/60)+"min"}],i=_.map(e.tasks,"_id");return e.schedule.from&&e.schedule.to&&(!_.isDate(e.schedule.from)&&(e.schedule.from=new Date(e.schedule.from)),!_.isDate(e.schedule.to)&&(e.schedule.to=new Date(e.schedule.to)),n.push({descr:"Agenda",value:r("%d/%m/%Y",e.schedule.from)}),n.push({descr:"Turno",value:r("%H:%M",e.schedule.from)+" <> "+r("%H:%M",e.schedule.to)})),i.length&&n.push({descr:"ID",value:i.join(", ")}),e.target&&n.push({descr:"Cliente",value:e.target.name,relevance:2}),n.push({value:e.address.address}),{id:"wRTask-"+e.id,worker:t.name,location:e.location,attrs:n}}))}.bind(this))},render:function(){return React.DOM.div({id:"RouterWorkers"},React.DOM.table(null,React.DOM.thead(null,React.DOM.tr(null,React.DOM.th(null,"Nome"),React.DOM.th(null,"Visitas"),React.DOM.th(null,"##"))),React.DOM.tbody(null,this.props.workers.map(function(e){return s({drawWorkerDirections:this.drawWorkerDirections,key:e._id,worker:e})}.bind(this)))))}}),u=React.createClass({displayName:"RouterController",getInitialState:function(){return{messages:[],workers:[],day:this.props.router._day}},componentDidMount:function(){this.props.router.progress(function(e,t){if(!this.isMounted())return;switch(e){case"message":this.state.messages.push(t),this.setState({messages:this.state.messages})}}.bind(this)),this.props.router.done(function(e){if(!this.isMounted())return;this.setState({workers:e})}.bind(this)),this.props.router.fail(function(){if(!this.isMounted())return;this.props.cancelRoute()}.bind(this))},cancel:function(){this.state.workers.forEach(function(e){e.cleanDirections&&e.cleanDirections()}),this.props.cancelRoute()},save:function(){this.state.workers.forEach(function(e){e.cleanDirections&&e.cleanDirections()}),this.props.saveRoute(this.state.workers,this.state.day)},render:function(){return React.DOM.div({id:"Router",className:"leftMapControl"},React.DOM.div({className:"controlIco"},React.DOM.i({className:"fi-page-multiple"})),React.DOM.div({className:"controlContent"},React.DOM.h3({className:"controlTitle"},"Roteador"),React.DOM.div({className:"panel contained clearfix"},!this.state.workers.length&&React.DOM.div({id:"RouterLog"},this.state.messages.map(function(e,t){return React.DOM.p({key:t},e)})),o({workers:this.state.workers,toggleRouterMode:this.props.toggleRouterMode}),React.DOM.div({className:"row"},React.DOM.div({className:"medium-12 columns text-right"},React.DOM.button({onClick:this.cancel,className:"tiny alert button"},"Cancelar"),this.state.workers&&this.state.workers.length?React.DOM.button({onClick:this.save,className:"tiny success button"},"Salvar"):null)))))}}),a=React.createClass({displayName:"ConsoleOpts",handleSubmit:function(e){e.preventDefault();var t={day:this.refs.dayInput.getDOMNode().value,org:pager.org.id,locations:this.props.locations};i.navigate("/:org/console/:day/:locations",{namedParams:t})},render:function(){return React.DOM.div({id:"ConsoleOpts",className:"leftMapControl"},React.DOM.div({className:"controlIco"},React.DOM.i({className:"fi-widget"})),React.DOM.div({className:"controlContent"},React.DOM.h3({className:"controlTitle"},"Opções da agenda"),React.DOM.div({className:"panel contained"},React.DOM.form({onSubmit:this.handleSubmit},React.DOM.div({className:"row"},React.DOM.div({className:"large-12 columns"},React.DOM.label(null,"Dia",e({ref:"dayInput",date:this.props.day,inputName:"day"})))),React.DOM.div({className:"row"},React.DOM.div({className:"large-12 columns text-right"},React.DOM.button({className:"tiny success button"},"Ok")))))))}}),f=React.createClass({displayName:"LeftPanel",componentDidMount:function(){function e(){$(this).closest(".leftMapControl").children(".controlContent,.controlIco").toggle(),$("#Console").trigger("resize")}$(this.getDOMNode()).on("click",".controlContent>.controlTitle,.controlIco",e)},render:function(){return React.DOM.nav({id:"LeftPanel"},React.DOM.div({id:"LeftPanelWrapper"},this.props.pending.length?t({items:this.props.pending,locations:this.props.locations}):null,a({day:this.props.day,locations:this.props.locations}),this.props.router?u({router:this.props.router,saveRoute:this.props.saveRoute,cancelRoute:this.props.cancelRoute,toggleRouterMode:this.props.toggleRouterMode}):null,n({routeTasks:this.props.routeTasks,locations:this.props.locations,day:this.props.day,setTaskFocus:this.props.setTaskFocus,selectedTask:this.props.selectedTask,hasGoogleMaps:this.props.hasGoogleMaps,queries:this.props.queries,setQueries:this.props.setQueries})))}});return f});