define(["./../lib/component.DateInput.js","./console.queue","./console.tasks","../ext/strftime"],function(f,g,h,d){var k=pager.Aviator,l=React.createClass({displayName:"RouterWorker",drawMe:function(){this.props.worker.tasks.length&&this.props.drawWorkerDirections(this.props.worker._id)},render:function(){return React.DOM.tr(null,React.DOM.td(null,this.props.worker.name),React.DOM.td(null,this.props.worker.tasks?this.props.worker.tasks.length:"0"),React.DOM.td(null,this.props.worker.tasks&&this.props.worker.tasks.length?
React.DOM.a({className:"radius ico fi-map",onClick:this.drawMe}):null))}}),m=React.createClass({displayName:"RouterWorkers",drawWorkerDirections:function(a){this.props.workers.forEach(function(c){c.tasks.length&&(c._id===a&&c.drawDirections()?this.props.toggleRouterMode(c._id,c.tasks.map(function(b){if(b.schedule){var a=[{relevance:3,value:c.name},{descr:"Tipos",value:_.uniq(b.types).join(", ")},{descr:"Deslocamento",value:d("%H:%M",b.directions.schedule.ini)+" < "+b.directions.duration.text+" - "+
b.directions.distance.text+" > "+d("%H:%M",b.directions.schedule.end)},{descr:"Execu\u00e7\u00e3o",value:d("%H:%M",b.schedule.ini)+" < "+Math.floor(b.duration/1E3/60)+"min > "+d("%H:%M",b.schedule.end)},{descr:"Dura\u00e7\u00e3o",value:Math.floor(b.duration/1E3/60)+"min"}],e=_.map(b.tasks,"_id");b.schedule.from&&b.schedule.to&&(!_.isDate(b.schedule.from)&&(b.schedule.from=new Date(b.schedule.from)),!_.isDate(b.schedule.to)&&(b.schedule.to=new Date(b.schedule.to)),a.push({descr:"Agenda",value:d("%d/%m/%Y",
b.schedule.from)}),a.push({descr:"Turno",value:d("%H:%M",b.schedule.from)+" <> "+d("%H:%M",b.schedule.to)}));e.length&&a.push({descr:"ID",value:e.join(", ")});b.target&&a.push({descr:"Cliente",value:b.target.name,relevance:2});a.push({value:b.address.address});return{id:"wRTask-"+b.id,worker:c.name,location:b.location,attrs:a}}})):(c._id!==a&&c.cleanDirections(),c._id===a&&this.props.toggleRouterMode(null)))}.bind(this))},render:function(){return React.DOM.div({id:"RouterWorkers"},React.DOM.table(null,
React.DOM.thead(null,React.DOM.tr(null,React.DOM.th(null,"Nome"),React.DOM.th(null,"Visitas"),React.DOM.th(null,"##"))),React.DOM.tbody(null,this.props.workers.map(function(a){return l({drawWorkerDirections:this.drawWorkerDirections,key:a._id,worker:a})}.bind(this)))))}}),n=React.createClass({displayName:"RouterController",getInitialState:function(){return{messages:[],workers:[],day:this.props.router._day}},componentDidMount:function(){this.props.router.progress(function(a,c){if(this.isMounted())switch(a){case "message":this.state.messages.push(c),
this.setState({messages:this.state.messages})}}.bind(this));this.props.router.done(function(a){this.isMounted()&&this.setState({workers:a})}.bind(this));this.props.router.fail(function(){this.isMounted()&&this.props.cancelRoute()}.bind(this))},cancel:function(){this.state.workers.forEach(function(a){a.cleanDirections&&a.cleanDirections()});this.props.cancelRoute()},save:function(){this.state.workers.forEach(function(a){a.cleanDirections&&a.cleanDirections()});this.props.saveRoute(this.state.workers,
this.state.day)},render:function(){return React.DOM.div({id:"Router",className:"leftMapControl"},React.DOM.div({className:"controlIco"},React.DOM.i({className:"fi-page-multiple"})),React.DOM.div({className:"controlContent"},React.DOM.h4(null,"Roteador"),React.DOM.div({className:"panel contained clearfix"},!this.state.workers.length&&React.DOM.div({id:"RouterLog"},this.state.messages.map(function(a,c){return React.DOM.p({key:c},a)})),m({workers:this.state.workers,toggleRouterMode:this.props.toggleRouterMode}),
React.DOM.div({className:"row"},React.DOM.div({className:"small-12 columns text-right"},React.DOM.button({onClick:this.cancel,className:"tiny alert button"},"Cancelar"),this.state.workers&&this.state.workers.length?React.DOM.button({onClick:this.save,className:"tiny success button"},"Salvar"):null)))))}}),p=React.createClass({displayName:"ConsoleOpts",handleSubmit:function(a){a.preventDefault();a={day:this.refs.dayInput.getDOMNode().value,org:pager.org.id,locations:this.props.locations};k.navigate("/:org/console/:day/:locations",
{namedParams:a})},render:function(){return React.DOM.div({id:"ConsoleOpts",className:"leftMapControl"},React.DOM.div({className:"controlIco"},React.DOM.i({className:"fi-widget"})),React.DOM.div({className:"controlContent"},React.DOM.h4(null,"Op\u00e7\u00f5es da agenda"),React.DOM.div({className:"panel contained"},React.DOM.form({onSubmit:this.handleSubmit},React.DOM.div({className:"row"},React.DOM.div({className:"large-12 columns"},React.DOM.label(null,"Dia",f({ref:"dayInput",date:this.props.day,
inputName:"day"})))),React.DOM.div({className:"row"},React.DOM.div({className:"large-12 columns text-right"},React.DOM.button({className:"tiny success button"},"Ok")))))))}});return React.createClass({displayName:"LeftPanel",componentDidMount:function(){$(this.getDOMNode()).on("click",".controlContent>h4,.controlIco",function(){$(this).closest(".leftMapControl").children(".controlContent,.controlIco").toggle();$("#Console").trigger("resize")})},render:function(){return React.DOM.nav({id:"LeftPanel"},
React.DOM.div({id:"LeftPanelWrapper"},this.props.pending.length?g({items:this.props.pending,locations:this.props.locations}):null,p({day:this.props.day,locations:this.props.locations}),this.props.router?n({router:this.props.router,saveRoute:this.props.saveRoute,cancelRoute:this.props.cancelRoute,toggleRouterMode:this.props.toggleRouterMode}):null,h({routeTasks:this.props.routeTasks,locations:this.props.locations,day:this.props.day,setTaskFocus:this.props.setTaskFocus,selectedTask:this.props.selectedTask,
hasGoogleMaps:this.props.hasGoogleMaps,queries:this.props.queries,setQueries:this.props.setQueries})))}})});
