define(["../helpers/utils","../helpers/consts","../ext/aviator/main"],function(e,l,d){function f(){"urls pagesEnabled org user org build".split(" ").forEach(function(a){var b=pager[a];b&&Modernizr.localstorage&&localStorage.setItem("pager."+pager.org.id+"."+a,JSON.stringify(b))})}pager.constant=l;var g,h,k;e=location.pathname.split("/");if(!e[1])return $("body").html("<h1>Erro</h1>");pager.org={id:e[1]};k=React.createClass({displayName:"PageList",navigateTo:function(a){var b=$(a.currentTarget).attr("href");
"/"===b.charAt(0)&&"//"!==b.substr(0,2)&&(a.preventDefault(),pager.Aviator.navigate(b))},render:function(){var a={acw_admin:"fi-lock",pager_admin:"fi-wrench",console:"fi-map"},b=this.props.pagesEnabled.map(function(b){var c=a[b.id];return React.DOM.li({key:b.name},React.DOM.a({onClick:this.navigateTo,href:b.url},c?React.DOM.i({className:"the-icon "+c}):null,b.name))}.bind(this)),c=this.props.urls.base;b.unshift(React.DOM.li({key:"usr.home"},React.DOM.a({href:c+"/home"},React.DOM.i({className:"the-icon fi-home"}),
"In\u00edcio")));b.unshift(React.DOM.li({key:"placeholder"},React.DOM.label(null,"Menu")));b.push(React.DOM.li({key:"usr"},React.DOM.label(null,"Usu\u00e1rio")));b.push(React.DOM.li({key:"usr.settings"},React.DOM.a({href:c+"/user"},React.DOM.i({className:"the-icon fi-torso"}),"Configura\u00e7\u00f5es")));b.push(React.DOM.li({key:"usr.logout"},React.DOM.a({href:c+"/logout"},React.DOM.i({className:"the-icon fi-x"}),"Logout")));return React.DOM.ul({className:"dropdown"},b)}});h=React.createClass({displayName:"Root",
getInitialState:function(){return{currentView:null,args:{},pagesEnabled:pager.pagesEnabled,urls:pager.urls}},initializeApp:function(a){var b=a.uri.split("/")[2]||null;this.setState({args:a.params,currentView:b});require(["./"+b],function(a){g=a;this.forceUpdate()}.bind(this))},setAppArgs:function(a){if((a.uri.split("/")[2]||null)!==this.state.currentView)return this.initializeApp(a);this.setState({args:a.params})},componentDidMount:function(){$(document).foundation();d.setRoutes({target:{goToMainPage:function(a){var b=
pager.user.home||"console";d.navigate((a.uri+"/").replace("//","/")+b)},setupLayout:function(){}},"/*":"setupLayout","/:org":{"/":"goToMainPage","/console":{target:this,"/":"initializeApp","/:day/:locations":"setAppArgs"},"/admin":{target:this,"/":"initializeApp","/:view":"setAppArgs"}}});d.dispatch();pager.Aviator=d;$.get("/"+pager.org.id+"/api/pages").done(function(a){_.isArray(a)&&(pager.pagesEnabled=a.concat(),this.setState({pagesEnabled:a}));f()}.bind(this))},render:function(){var a=g;return React.DOM.div(null,
React.DOM.nav({id:"MainTopBar",className:"top-bar","data-topbar":!0},React.DOM.ul({className:"title-area"},React.DOM.li({className:"name"},React.DOM.h1(null,React.DOM.a(null,"Pager"+(pager.org&&pager.org.name?" - "+pager.org.name:"")))),React.DOM.li({className:"toggle-topbar menu-icon"},React.DOM.a({href:"#"},React.DOM.span(null)))),React.DOM.section({className:"top-bar-section"},React.DOM.ul({className:"right"},React.DOM.li({className:"has-dropdown"},React.DOM.a(null,"Menu"),k({urls:this.state.urls,
pagesEnabled:this.state.pagesEnabled}))))),a&&a({args:this.state.args}))}});pager.pagesEnabled=[];pager.components={};Modernizr.localstorage&&["urls","pagesEnabled","org","user"].forEach(function(a){var b=localStorage.getItem("pager."+pager.org.id+"."+a);pager[a]=b&&JSON.parse(b)||pager[a]});$(document).ajaxError(function(a,b){401===b.status&&(pager.urls?location.href=pager.urls.base+"/login":location.reload(!0))});pager.org&&$.get("/"+pager.org.id+"/api").done(function(a){_.isObject(a)&&(_.merge(pager,
a),pager.urls.ajax="/"+pager.org.id+"/api/",f())}).always(function(){pager.rootElem=React.renderComponent(h(null),document.getElementById("container"))});return pager});
