define(function(){return React.createClass({displayName:"ImportForm",getInitialState:function(){return{uploadProgress:null}},isValidFile:function(b){return(b=b.files[0])&&-1<b.type.indexOf("csv")},changeFile:function(b){var a=b.currentTarget.files[0];b=null;if(a){b=a.name;var c=a.type;var a=a.size,e=["Bytes","KB","MB"],d;0===a?a="n/a":(d=parseInt(Math.floor(Math.log(a)/Math.log(1024)),10),a=(a/Math.pow(1024,d)).toFixed(1)+" "+e[d]);b={name:b,type:c,size:a}}this.setState({fileDescr:b})},handleSubmit:function(b){b.preventDefault();
if(null===this.state.uploadProgress)if(this.isValidFile(this.refs.csvFile.getDOMNode())){b=new FormData(b.currentTarget);var a=new XMLHttpRequest,c=this;a.open("POST",pager.urls.ajax+"admin/work_orders",!0);a.onload=function(a){c.isMounted()&&(200===this.status||204===this.status?$(React.renderComponentToStaticMarkup(React.DOM.div({"data-alert":!0,className:"alert-box success radius"},"Upload completo: ",this.responseText,React.DOM.a({href:"#",className:"close"},"\u00d7")))).insertAfter($(c.refs.fieldSet.getDOMNode()).find("legend")):
$(React.renderComponentToStaticMarkup(React.DOM.div({"data-alert":!0,className:"alert-box warning radius"},"Falha no upload: "+this.responseText,React.DOM.a({href:"#",className:"close"},"\u00d7")))).insertAfter($(c.refs.fieldSet.getDOMNode()).find("legend")),c.setState({uploadProgress:null}))};a.upload.onprogress=function(a){c.isMounted()&&a.lengthComputable&&c.setState({uploadProgress:a.loaded/a.total*100})};a.send(b)}else $(React.renderComponentToStaticMarkup(React.DOM.div({"data-alert":!0,className:"alert-box alert radius"},
"Arquivo Inv\u00e1lido",React.DOM.a({href:"#",className:"close"},"\u00d7")))).insertAfter($(this.refs.fieldSet.getDOMNode()).find("legend"))},render:function(){return React.DOM.form({onSubmit:this.handleSubmit,encType:"multipart/form-data"},React.DOM.fieldset({ref:"fieldSet"},React.DOM.legend(null,"Planilha de Ordens (CSV)"),React.DOM.progress({className:"ProgressBar",value:this.state.uploadProgress,max:100,style:{display:null===this.state.uploadProgress?"none":""}}),React.DOM.div({className:"row"},
React.DOM.div({className:"small-10 columns"},React.DOM.input({type:"file",required:!0,ref:"csvFile",onChange:this.changeFile,name:"csv"})),React.DOM.div({className:"small-2 columns"},React.DOM.button({className:"success button postfix",disabled:null!==this.state.uploadProgress},"Upload"))),this.state.fileDescr?React.DOM.div({id:"AdminFileDescriptor"},React.DOM.span({className:"label secondary"},this.state.fileDescr.name),React.DOM.span({className:"label secondary"},this.state.fileDescr.type),React.DOM.span({className:"label secondary"},
this.state.fileDescr.size)):null))}})});
