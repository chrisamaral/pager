define(function(){return React.createClass({displayName:"ImportForm",getInitialState:function(){return{uploadProgress:null}},isValidFile:function(a){return(a=a.files[0])&&"text/csv"===a.type},handleSubmit:function(a){a.preventDefault();if(null===this.state.uploadProgress)if(this.isValidFile(this.refs.csvFile.getDOMNode())){a=new FormData(a.currentTarget);var c=new XMLHttpRequest,b=this;c.open("POST",pager.urls.ajax+"admin/work_orders",!0);c.onload=function(a){b.isMounted()&&(200===this.status||204===
this.status?$(React.renderComponentToStaticMarkup(React.DOM.div({"data-alert":!0,className:"alert-box success radius"},"Upload completo: ",this.responseText,React.DOM.a({href:"#",className:"close"},"\u00d7")))).insertAfter($(b.refs.fieldSet.getDOMNode()).find("legend")):$(React.renderComponentToStaticMarkup(React.DOM.div({"data-alert":!0,className:"alert-box warning radius"},"Falha no upload: "+this.responseText,React.DOM.a({href:"#",className:"close"},"\u00d7")))).insertAfter($(b.refs.fieldSet.getDOMNode()).find("legend")),
b.setState({uploadProgress:null}))};c.upload.onprogress=function(a){b.isMounted()&&a.lengthComputable&&b.setState({uploadProgress:a.loaded/a.total*100})};c.send(a)}else $(React.renderComponentToStaticMarkup(React.DOM.div({"data-alert":!0,className:"alert-box alert radius"},"Arquivo Inv\u00e1lido",React.DOM.a({href:"#",className:"close"},"\u00d7")))).insertAfter($(this.refs.fieldSet.getDOMNode()).find("legend"))},render:function(){return React.DOM.form({onSubmit:this.handleSubmit,encType:"multipart/form-data"},
React.DOM.fieldset({ref:"fieldSet"},React.DOM.legend(null,"Planilha de Ordens (CSV)"),React.DOM.progress({className:"ProgressBar",value:this.state.uploadProgress,max:100,style:{display:null===this.state.uploadProgress?"none":""}}),React.DOM.div({className:"row"},React.DOM.div({className:"small-10 columns"},React.DOM.input({type:"file",required:!0,ref:"csvFile",name:"csv"})),React.DOM.div({className:"small-2 columns"},React.DOM.button({className:"success button postfix",disabled:null!==this.state.uploadProgress},
"Upload")))))}})});
