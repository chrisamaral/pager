/** @jsx React.DOM */define(["./component.DateInput"],function(e){var t,n,r,i,s,o,u,a,f,l={schedule:"Agenda::Ordem",task_id:"Código::Ordem",creation:"Ingresso::Ordem",task_status:"Status::Ordem",task_type:"Tipo::Ordem",customer_id:"Código::Cliente",customer_name:"Nome::Cliente",address:"Endereço::Cliente"};return s=React.createClass({displayName:"TxtInput",render:function(){return React.DOM.input({name:this.props.inputName,required:!0,autoComplete:"on",type:"text",defaultValue:"",placeholder:this.props.name})}}),i=React.createClass({displayName:"FilterItem",killFilter:function(e){e.preventDefault(),this.props.removeFilter(this.props.index)},render:function(){var t;switch(this.props.id){case"schedule":case"creation":t=e;break;default:t=s}return React.DOM.div({className:"row"},React.DOM.div({className:"large-12 columns text-right"},React.DOM.label(null,React.DOM.strong(null,this.props.name,React.DOM.a({onClick:this.killFilter}," - ")),t({id:this.props.id,name:this.props.name,inputName:this.props.id}))))}}),r=React.createClass({displayName:"FilterList",handleSubmit:function(e){e.preventDefault();var t=$(e.currentTarget).serializeArray(),n={};_.forEach(t,function(e){if(!e||_.isString(e.value)&&!e.value.length)return;n[e.name]=n[e.name]||[],n[e.name].push(e.value)}),$.get(pager.urls.ajax+"console/tasks/"+this.props.day,n).done(function(e){if(!_.isArray(e))return;this.props.pushQuery(n,e)}.bind(this))},render:function(){var e=this.props.filters.map(function(e,t){var n=Foundation.utils.random_str(10);return i({key:e.key,index:t,id:e.id,name:e.name,removeFilter:this.props.removeFilter})}.bind(this));return React.DOM.div({className:"filter-list panel"},React.DOM.form({onSubmit:this.handleSubmit},e,React.DOM.div({className:"row"},React.DOM.div({className:"large-12 columns text-right"},React.DOM.button({type:"submit",className:"tiny success button"},"Buscar")))))}}),u=React.createClass({displayName:"QueryInfoDropDown",render:function(){return React.DOM.div({"data-dropdown-content":!0,className:"f-dropdown content medium hide",id:this.props.id},React.DOM.h4({className:"subheader"},(this.props.count||"Nenhuma")+(this.props.count>1?" ordens":" ordem")),React.DOM.table({className:"queryInfoDropDownTable"},React.DOM.tbody(null,_.map(this.props.query,function(e,t){return React.DOM.tr({key:t},React.DOM.td(null,l[t]),React.DOM.td(null,e.map(function(e,t){return React.DOM.span({key:t,className:"round secondary label"},e)})))}))))}}),a=React.createClass({displayName:"QueryTask",killMe:function(){this.props.removeTask(this.props.index),this.props.selectedTask===this.props.task._id&&this.mapFocusOnMe()},mapFocusOnMe:function(){this.props.setTaskFocus(this.props.task._id)},render:function(){var e=pager.components.AttrTable,t=React.addons.classSet({queryTask:!0,selectedTask:this.props.selectedTask===this.props.task._id});return React.DOM.div({className:t,"data-task":this.props.task._id},React.DOM.span({className:"icos"},this.props.task.location&&React.DOM.a({className:"radius ico fi-target-two",onClick:this.mapFocusOnMe,title:"Selecionar"}),React.DOM.a({className:"radius ico fi-x",ref:"menuBt",title:"Descartar",onClick:this.killMe})),e({attrs:this.props.task.attrs}))}}),f=React.createClass({displayName:"LookupProgress",getInitialState:function(){return{lookupProgress:null,alreadyStartedLookup:!1}},startGeoLookup:function(){if(this.state.alreadyStartedLookup)return;this.setState({alreadyStartedLookup:!0}),require(["../lib/task.geocoder"],function(e){var t=new e(this.props.tasks);t.onProgress=function(e,n,r,i){if(!this.isMounted())return t.abort();try{this.setState({lookupProgress:n?Math.floor(100*e/n):null},function(){i!=="unchanged"&&this.props.updateTask(r)}.bind(this))}catch(s){throw t.abort(),s}}.bind(this),t.onComplete=function(){setTimeout(function(){this.setState({lookupProgress:null})}.bind(this),2e3)}.bind(this),t.init()}.bind(this))},componentWillReceiveProps:function(e){e.hasGoogleMaps&&this.startGeoLookup()},componentDidMount:function(){this.props.hasGoogleMaps&&this.startGeoLookup()},render:function(){var e={};return this.state.lookupProgress===null&&(e.display="none"),React.DOM.progress({style:e,value:this.state.lookupProgress,max:100,title:this.state.lookupProgress+"% das ordens foram localizadas"})}}),o=React.createClass({displayName:"QueryElem",getInitialState:function(){return{taskLength:this.props.query.tasks.length,auxId:"q"+Math.random().toString(36).substr(2)}},killMe:function(e){e.preventDefault(),this.props.popQuery(this.props.index)},routeMe:function(e){e.preventDefault(),this.props.routeThem(this.props.query.tasks)},cleanDropdown:function(){$("#"+this.state.auxId+"Menu").remove(),$("#"+this.state.auxId+"Info").remove()},renderDropdown:function(){this.cleanDropdown();var e=$(React.renderComponentToString(React.DOM.ul({id:this.state.auxId+"Menu",className:"tiny f-dropdown hide","data-dropdown-content":!0},React.DOM.li(null,React.DOM.a({id:this.state.auxId+"routeMe"},"Rotear")),React.DOM.li(null,React.DOM.a({id:this.state.auxId+"killMe"},"Descartar"))))).appendTo("body"),t=$(React.renderComponentToString(u({id:this.state.auxId+"Info",count:this.props.query.tasks.length,query:this.props.query.query}))).appendTo("body");$("#"+this.state.auxId+"killMe").click(this.killMe),$("#"+this.state.auxId+"routeMe").click(this.routeMe),$([this.getDOMNode(),e[0],t[0]]).foundation()},componentDidMount:function(){this.renderDropdown()},componentWillUnmount:function(){this.cleanDropdown()},componentDidUpdate:function(){this.props.query.tasks.length!==this.state.taskLength&&(this.renderDropdown(),this.setState({taskLength:this.props.query.tasks.length}))},removeTask:function(e){var t=this.props.query.tasks;t.splice(e,1),this.setTasks(t)},updateTask:function(e){var t=this.props.query.tasks,n=_.findIndex(t,{_id:e._id});if(n<0)return;t[n]=e,this.setTasks(t)},setTasks:function(e){var t=this.props.query;t.tasks=e,this.props.setQuery(t,this.props.index)},toggleMe:function(e){$(e.currentTarget).parent().children(".QueryElem").toggle()},render:function(){var e=function(e){e.stopPropagation()};return React.DOM.div({className:"panel sequential queryResult"},React.DOM.h5({className:"clearfix",onClick:this.toggleMe},this.props.query.name?this.props.query.name:null,React.DOM.a({onClick:e,className:"right radius ico fi-info",title:"Informação","data-dropdown":this.state.auxId+"Info"}),React.DOM.a({onClick:e,className:"right radius ico fi-list",title:"Menu","data-dropdown":this.state.auxId+"Menu"})),f({updateTask:this.updateTask,tasks:this.props.query.tasks,hasGoogleMaps:this.props.hasGoogleMaps}),React.DOM.div({ref:"tasks",className:"QueryElem no-flow-x"},this.props.query.tasks.map(function(e,t){return a({key:e._id,index:t,task:e,setTaskFocus:this.props.setTaskFocus,selectedTask:this.props.selectedTask,removeTask:this.removeTask})}.bind(this))))}}),n=React.createClass({displayName:"TaskInput",getInitialState:function(){return{filters:[]}},pushQuery:function(e,t){var n=this.props.queries,r={};r.query=e,r.tasks=t,n.push(r),this.props.setQueries(n),this.setState({filters:[]})},setQuery:function(e,t){var n=this.props.queries;n[t]=e,this.props.setQueries(n)},popQuery:function(e){var t=this.props.queries.concat();t.splice(e,1),this.props.setQueries(t)},removeFilter:function(e){var t=[].concat(this.state.filters);t.splice(e,1),this.setState({filters:t})},createFilter:function(e){e.preventDefault();var t=this.state.filters,n=this.refs.filterType.getDOMNode();t.push({id:n.value,key:"filter-"+Math.random().toString(36).substr(2),name:$(n).find("option:selected").text()}),this.setState({filters:t})},createTask:function(e){e.preventDefault()},render:function(){return React.DOM.div({className:"TaskInput panel contained"},React.DOM.form({onSubmit:this.createFilter},React.DOM.div({className:"row"},React.DOM.div({className:"large-12 columns"},React.DOM.label(null,"Filtrar por",React.DOM.select({name:"type",ref:"filterType"},_.map(l,function(e,t){return React.DOM.option({key:t,value:t},e)}))))),React.DOM.div({className:"row"},React.DOM.div({className:"large-12 columns text-right"},React.DOM.button({disabled:!0,className:"tiny secondary button",onClick:this.createTask},"+ Ordem"),React.DOM.button({type:"submit",className:"tiny success button"},"+ Filtro")))),this.state.filters.length?r({removeFilter:this.removeFilter,day:this.props.day,filters:this.state.filters,pushQuery:this.pushQuery}):null,React.DOM.div({className:"panel sequential contained"},this.props.queries.map(function(e,t){return o({routeThem:this.props.routeThem,setTaskFocus:this.props.setTaskFocus,selectedTask:this.props.selectedTask,hasGoogleMaps:this.props.hasGoogleMaps,popQuery:this.popQuery,setQuery:this.setQuery,key:e.id,index:t,query:e})}.bind(this))))}}),t=React.createClass({displayName:"Tasks",routeThem:function(e){this.props.routeTasks(e)},componentDidUpdate:function(){$(this.refs.clickToRoute.getDOMNode()).off("click",this.routeThemAll).on("click",this.routeThemAll)},componentDidMount:function(){$(this.refs.clickToRoute.getDOMNode()).off("click",this.routeThemAll).on("click",this.routeThemAll)},routeThemAll:function(e){e.stopPropagation(),e.preventDefault();var t=[];return this.props.queries.forEach(function(e){e.tasks.forEach(function(e){_.any(e,{sys_id:e.sys_id})||t.push(e)})}),this.routeThem(t),!1},render:function(){return React.DOM.div({id:"Tasks",className:"leftMapControl"},React.DOM.div({className:"controlIco"},React.DOM.i({className:"fi-calendar"})),React.DOM.div({className:"controlContent"},React.DOM.h3({className:"controlTitle"},"Ordens livres",React.DOM.a({ref:"clickToRoute",className:"right radius ico fi-fast-forward",title:"Rotear todos"})),n({routeThem:this.routeThem,locations:this.props.locations,day:this.props.day,setTaskFocus:this.props.setTaskFocus,selectedTask:this.props.selectedTask,hasGoogleMaps:this.props.hasGoogleMaps,setQueries:this.props.setQueries,queries:this.props.queries})))}}),t});