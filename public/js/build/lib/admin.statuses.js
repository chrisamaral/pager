define(function(){function c(a){a=a||[];var b={pendente:[],agendado:[],finalizado:[],suspenso:[],cancelado:[]};_.forEach(a,function(a){a.name&&_.isArray(a.references)&&(b[a.name]=_.uniq(b[a.name].concat(a.references)))});return b}var d=React.createClass({displayName:"StatusForm",getInitialState:function(){return{locked:!1}},handleSubmit:function(a){a.preventDefault();this.setState({locked:!0});$.post(pager.urls.ajax+"admin/status/"+this.props.name+"/"+this.refs.newRef.getDOMNode().value).always(function(){this.isMounted()&&
(this.refs.newRef.getDOMNode().value="",this.setState({locked:!1}))}.bind(this)).done(this.props.reloadAll)},removeOne:function(a){a.preventDefault();a=$(a.currentTarget);$.ajax({type:"DELETE",url:a.attr("href")}).always(this.props.reloadAll)},render:function(){return React.DOM.fieldset(null,React.DOM.legend({className:"textCapitalize"},this.props.name),React.DOM.form({onSubmit:this.handleSubmit},React.DOM.div({className:"row"},React.DOM.div({className:"small-12 columns"},React.DOM.label(null,"Novo status",
React.DOM.input({type:"text",ref:"newRef",name:"reference",disabled:this.state.locked,required:!0}))))),React.DOM.ul(null,this.props.references.map(function(a){return React.DOM.li({key:a,className:"textCapitalize"},a,React.DOM.a({onClick:this.removeOne,className:"killStatus close",href:pager.urls.ajax+"admin/status/"+this.props.name+"/"+a},"\u00d7"))}.bind(this))))}});return React.createClass({displayName:"Statuses",getInitialState:function(){return{statuses:c()}},reloadAll:function(){$.get(pager.urls.ajax+
"admin/statuses").done(function(a){this.isMounted()&&this.setState({statuses:c(a)})}.bind(this))},componentDidMount:function(){this.reloadAll()},render:function(){return React.DOM.div({className:"small-block-grid-3"},_.map(this.state.statuses,function(a,b){return d({reloadAll:this.reloadAll,name:b,references:a,key:b})}.bind(this)))}})});
