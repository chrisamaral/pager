define(function(){return{updateDefaultQuery:function(e){var t=this.state.queries,n={id:"query-"+Math.random().toString(36).substr(2),name:"Agenda",tasks:[],query:{schedule:[this.state.day]}},r=_.findIndex(t,{name:"Agenda"});if(r>=0){if(t[r].query.schedule[0]===n.query.schedule[0])return;t[r]=n}else{if(!e)return;t.unshift(n)}this.setState({queries:t},this.syncQueries)},setQueries:function(e){e=e.filter(function(e,t){return e.name==="Agenda"||e.tasks}).map(function(e){return e.id=e.id||"query-"+Math.random().toString(36).substr(2),e}),Modernizr.localstorage&&localStorage.setItem("pager."+pager.org.id+".console.queries",JSON.stringify(this.state.queries.filter(function(e){return e.name!=="Agenda"}).map(function(e){return e=_.clone(e),e.tasks=[],e}))),this.setState({queries:e})},fetchQuery:function(e){return $.get(pager.urls.ajax+"console/tasks/"+this.state.day,e.query).done(function(t){if(!_.isArray(t))return;var n=this.state.queries,r=_.find(n,{id:e.id})||_.find(n,{name:e.name});if(!r)return;r.tasks=t,this.setState({queries:n})}.bind(this))},fetchQueries:function(e){var t=[],n;this.state.queries.forEach(function(e){t.push(this.fetchQuery(e))}.bind(this)),n=$.when.apply($,t),_.isFunction(e)&&n.always(e)},syncQueries:function(){clearTimeout(this.syncQueries.__timeout);if(!this.isMounted())return;this.fetchQueries(function(){this.syncQueries.__timeout=setTimeout(this.syncQueries,pager.constant.console.QUERY_UPDATE_INTERVAL)}.bind(this))}}});