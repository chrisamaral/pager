define(function(){return{updateDefaultQuery:function(b){var a=this.state.queries,d={id:"query-"+Math.random().toString(36).substr(2),name:"Agenda",tasks:[],query:{schedule:[this.state.day]}},c=_.findIndex(a,{name:"Agenda"});if(0<=c){if(a[c].query.schedule[0]===d.query.schedule[0])return;a[c]=d}else{if(!b)return;a.unshift(d)}this.setState({queries:a})},setQueries:function(b){b=b.filter(function(a,b){return"Agenda"===a.name||a.tasks}).map(function(a){a.id=a.id||"query-"+Math.random().toString(36).substr(2);
return a});Modernizr.localstorage&&localStorage.setItem("pager."+pager.org.id+".console.queries",JSON.stringify(this.state.queries.filter(function(a){return"Agenda"!==a.name}).map(function(a){a=_.clone(a);a.tasks=[];return a})));this.setState({queries:b})},fetchQuery:function(b,a){return $.get(pager.urls.ajax+"console/tasks/"+this.state.day,b.query).done(function(b){if(_.isArray(b)){var c=this.state.queries;c[a].tasks=b;this.setState({queries:c})}}.bind(this))},fetchQueries:function(b){var a=[];this.state.queries.forEach(function(b,
c){a.push(this.fetchQuery(b,c))}.bind(this));$.when.apply($,a).always(b?b:function(){})},syncQueries:function(){if(!this.isMounted())return clearTimeout(this.syncQueries.__timeout);this.syncQueries.__locked||(this.syncQueries.__locked=!0,this.fetchQueries(this.state.day,function(){this.syncQueries.__locked=!1;this.syncQueries.__timeout=setTimeout(this.syncQueries,pager.constant.console.QUERY_UPDATE_INTERVAL)}.bind(this)))}}});
