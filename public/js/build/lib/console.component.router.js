define(function(){return{toggleRouterMode:function(c,e){var d={};c?(d.mapState=pager.constant.console.map.ROUTER_PROJECTION,d.routerWorker={wayPoints:e}):(d.mapState=pager.constant.console.map.AVAILABLE_TASKS,d.routerWorker=null);this.setState(d)},killRoute:function(){var c={};this.state.mapState===pager.constant.console.map.ROUTER_PROJECTION&&(c.mapState=pager.constant.console.map.AVAILABLE_TASKS,c.routerWorker=null);this.state.router.stopRouter();c.router=null;this.setState(c)},saveRoute:function(c,
e){function d(a){var b={addressPlusTargetIDSHA1:a.addressPlusTargetIDSHA1,address:a.address,location:a.location,directions:a.directions,duration:a.duration,schedule:a.schedule,work_orders:_.map(a.tasks,function(a){return{_id:a._id,attrs:a.attrs,type:a.type}})};a.ref&&a.target&&(b.ref=a.ref,b.target=a.target);return b}var f=_.map(c,function(a){var b={worker:{_id:a._id,name:a.name,workShift:a.workShift},tasks:_.map(a.tasks,d)};b.work_orders=_.uniq(_.flatten(_.map(b.tasks,function(a){return _.map(a.work_orders,
"_id")})));_.forEach(b.tasks,function(a){a.target&&(b[a.ref+"s"]||(b[a.ref+"s"]=[]),b[a.ref+"s"].push(a.target._id))});a.startPoint&&(b.startPoint=a.startPoint);a.endPoint&&(b.endPoint=a.endPoint);return b});$.ajax({type:"POST",url:pager.urls.ajax+"console/schedule/"+e,contentType:"application/json; charset=utf-8",data:JSON.stringify(f)}).always(function(){this.updateSchedule();this.syncQueries()}.bind(this));this.killRoute()},cancelRoute:function(){this.killRoute()},startRouter:function(c){var e=
this,d=this.state.day;if(!this.state.router){if(!Modernizr.webworkers)return alert("Este navegador n\u00e3o suporta as tecnologias necess\u00e1rias para utiliza\u00e7\u00e3o do roteador. Por favor, atualize seu browser e tente novamente.");require(["../lib/router","./console.router.cfg"],function(f,a){var b={};pager.components.RouterCfg=a;e.isMounted()&&(b.routerLoader=function(a){var b={routerLoader:null};e.isMounted()&&a&&a.length&&(b.router=new f(d,c,a),b.router._day=d);e.setState(b)},b.routerLoader._day=
d,e.setState(b))})}},initRouter:function(c){this.startRouter(c)}}});
