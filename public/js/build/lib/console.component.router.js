define(function(){return{toggleRouterMode:function(e,t){var n={};e?(n.mapState=pager.constant.console.map.ROUTER_PROJECTION,n.routerWorker={wayPoints:t}):(n.mapState=pager.constant.console.map.AVAILABLE_TASKS,n.routerWorker=null),this.setState(n)},killRoute:function(){var e={};this.state.mapState===pager.constant.console.map.ROUTER_PROJECTION&&(e.mapState=pager.constant.console.map.AVAILABLE_TASKS,e.routerWorker=null),this.state.router.stopRouter(),e.router=null,this.setState(e)},saveRoute:function(e,t){function n(e){var t={addressPlusTargetIDSHA1:e.addressPlusTargetIDSHA1,address:e.address,location:e.location,directions:e.directions,duration:e.duration,schedule:e.schedule,work_orders:_.map(e.tasks,function(e){return{_id:e._id,attrs:e.attrs,type:e.type}})};return e.ref&&e.target&&(t.ref=e.ref,t.target=e.target),t}function r(e){var t={worker:{_id:e._id,name:e.name,workShift:e.workShift},tasks:_.map(e.tasks,n)};return t.work_orders=_.uniq(_.flatten(_.map(t.tasks,function(e){return _.map(e.work_orders,"_id")}))),_.forEach(t.tasks,function(e){e.target&&(t[e.ref+"s"]||(t[e.ref+"s"]=[]),t[e.ref+"s"].push(e.target._id))}),e.startPoint&&(t.startPoint=e.startPoint),e.endPoint&&(t.endPoint=e.endPoint),t}var i=_.map(e,r);$.ajax({type:"POST",url:pager.urls.ajax+"console/schedule/"+t,contentType:"application/json; charset=utf-8",data:JSON.stringify(i)}).always(function(){this.updateSchedule(),this.syncQueries()}.bind(this)),this.killRoute()},cancelRoute:function(){this.killRoute()},startRouter:function(e){var t=this,n=this.state.day;if(this.state.router)return;if(!Modernizr.webworkers)return alert("Este navegador não suporta as tecnologias necessárias para utilização do roteador. Por favor, atualize seu browser e tente novamente.");require(["../lib/router","./console.router.cfg"],function(r,i){var s={};pager.components.RouterCfg=i;if(!t.isMounted())return;s.routerLoader=function(i){var s={routerLoader:null};t.isMounted()&&i&&i.length&&(s.router=new r(n,e,i),s.router._day=n),t.setState(s)},s.routerLoader._day=n,t.setState(s)})},initRouter:function(e){this.startRouter(e)}}});